<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Transaction.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>Transaction.cpp</h1><a href="Transaction_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> </span>
00003 <span class="comment">Copyright (c) 2003, Cornell University</span>
00004 <span class="comment">All rights reserved.</span>
00005 <span class="comment"> </span>
00006 <span class="comment">Redistribution and use in source and binary forms, with or without</span>
00007 <span class="comment">modification, are permitted provided that the following conditions are met:</span>
00008 <span class="comment"> </span>
00009 <span class="comment">    - Redistributions of source code must retain the above copyright notice,</span>
00010 <span class="comment">        this list of conditions and the following disclaimer.</span>
00011 <span class="comment">    - Redistributions in binary form must reproduce the above copyright</span>
00012 <span class="comment">        notice, this list of conditions and the following disclaimer in the</span>
00013 <span class="comment">        documentation and/or other materials provided with the distribution.</span>
00014 <span class="comment">    - Neither the name of Cornell University nor the names of its</span>
00015 <span class="comment">        contributors may be used to endorse or promote products derived from</span>
00016 <span class="comment">        this software without specific prior written permission.</span>
00017 <span class="comment"> </span>
00018 <span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</span>
00019 <span class="comment">AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
00020 <span class="comment">IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
00021 <span class="comment">ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
00022 <span class="comment">LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
00023 <span class="comment">CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
00024 <span class="comment">SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
00025 <span class="comment">INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
00026 <span class="comment">CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
00027 <span class="comment">ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF</span>
00028 <span class="comment">THE POSSIBILITY OF SUCH DAMAGE.</span>
00029 <span class="comment"> </span>
00030 <span class="comment">*/</span>
00031 <span class="comment"></span>
00032 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00033 <span class="comment">///</span>
00034 <span class="comment">/// Transaction.cpp</span>
00035 <span class="comment">///</span>
00036 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00037 <span class="comment"></span>
00038 <span class="preprocessor">#include "<a class="code" href="Transaction_8h.html">Transaction.h</a>"</span>
00039 <span class="preprocessor">#include &lt;vector&gt;</span>
00040 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00041 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00042 <span class="comment"></span>
00043 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00044 <span class="comment">/// @addtogroup InputOutput</span>
00045 <span class="comment"></span><span class="comment">/** @{ */</span>
00046 <span class="comment"></span>
00047 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00048 <span class="comment">/// Get next transaction from the input file</span>
00049 <span class="comment">///</span>
00050 <span class="comment">/// @return     pointer to a new Transaction</span>
00051 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00052"></a><a class="code" href="classInputData.html#a8">00052</a> <span class="comment"></span><a class="code" href="classTransaction.html">Transaction</a> *<a class="code" href="group__InputOutput.html#a8">InputData::getNextTransaction</a>() {
00053     <span class="keywordtype">char</span> c;
00054 
00055     <span class="keywordtype">int</span> itemIndex = 0;
00056     <span class="keywordflow">if</span> (isAsciiFile) {
00057         <span class="comment">// read list of items</span>
00058         <span class="keywordflow">do</span> {
00059             <span class="keywordtype">int</span> item = 0, pos = 0;
00060             <a class="code" href="classInputData.html#InputDatao0">inputFile</a>.get(c);
00061             <span class="keywordflow">while</span> (!<a class="code" href="classInputData.html#InputDatao0">inputFile</a>.eof() &amp;&amp; (c &gt;= <span class="charliteral">'0'</span>) &amp;&amp; (c &lt;= <span class="charliteral">'9'</span>)) {
00062                 item *= 10;
00063                 item += int(c) - int(<span class="charliteral">'0'</span>);
00064                 <a class="code" href="classInputData.html#InputDatao0">inputFile</a>.get(c);
00065                 pos++;
00066             }
00067 
00068             <span class="keywordflow">if</span> (pos) {
00069                 <a class="code" href="classInputData.html#InputDatam0">itembuffer</a>[itemIndex] = item;
00070                 itemIndex++;
00071             }
00072         } <span class="keywordflow">while</span> (!<a class="code" href="classInputData.html#InputDatao0">inputFile</a>.eof() &amp;&amp; c != <span class="charliteral">'\n'</span>);
00073 
00074         <span class="comment">// if end of file is reached</span>
00075         <span class="keywordflow">if</span> (itemIndex == 0)
00076             <span class="keywordflow">return</span> 0;
00077     } <span class="keywordflow">else</span> {
00078         <span class="keywordtype">int</span> custid;              <span class="comment">// customer id (NOT used currently)</span>
00079         <span class="keywordtype">int</span> transid;             <span class="comment">// transaction id</span>
00080         <span class="keywordtype">int</span> nitems = 0;              <span class="comment">// number of items in the transaction</span>
00081 
00082         <span class="keywordflow">if</span> (!<a class="code" href="classInputData.html#InputDatao0">inputFile</a>.eof()) {
00083             <span class="comment">// read in the transaction</span>
00084             <a class="code" href="classInputData.html#InputDatao0">inputFile</a>.read((<span class="keywordtype">char</span> *)&amp;custid, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00085             <a class="code" href="classInputData.html#InputDatao0">inputFile</a>.read((<span class="keywordtype">char</span> *)&amp;transid, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00086             <a class="code" href="classInputData.html#InputDatao0">inputFile</a>.read((<span class="keywordtype">char</span> *)&amp;nitems, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));      
00087 
00088             <span class="comment">// ensure that there are not too many items</span>
00089             <span class="keywordflow">if</span> (nitems &gt;= <a class="code" href="Transaction_8h.html#a0">MAX_NUM_ITEMS</a>) {
00090                 cout &lt;&lt; <span class="stringliteral">"More than "</span> &lt;&lt; <a class="code" href="Transaction_8h.html#a0">MAX_NUM_ITEMS</a>
00091                 &lt;&lt; <span class="stringliteral">" items in customer id: "</span> &lt;&lt; custid
00092                 &lt;&lt; <span class="stringliteral">" transaction id: "</span> &lt;&lt; transid;
00093                 exit(1);
00094             }
00095 
00096             <span class="comment">// Read in the items of the transaction</span>
00097             <a class="code" href="classInputData.html#InputDatao0">inputFile</a>.read((<span class="keywordtype">char</span> *)<a class="code" href="classInputData.html#InputDatam0">itembuffer</a>, nitems * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00098         }
00099         
00100         itemIndex = nitems;
00101         <span class="keywordflow">if</span> (itemIndex == 0)
00102             <span class="keywordflow">return</span> 0;
00103     }
00104 
00105     <span class="comment">// Note, also last transaction must end with newline,</span>
00106     <span class="comment">// else, it will be ignored</span>
00107 
00108     <span class="comment">// sort list of items (this is not necessary for the workshop test datasets)</span>
00109     <span class="comment">// sort(list.begin(),list.end());</span>
00110 
00111     <span class="comment">// put items in Transaction structure</span>
00112     <a class="code" href="classTransaction.html">Transaction</a> *newTransaction = <span class="keyword">new</span> <a class="code" href="classTransaction.html">Transaction</a>(<a class="code" href="classInputData.html#InputDatam0">itembuffer</a>, itemIndex);
00113     <span class="keywordflow">return</span> newTransaction;
00114 }
00115 <span class="comment"></span>
00116 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00117 <span class="comment">/// Open the input file</span>
00118 <span class="comment">///</span>
00119 <span class="comment">/// @param filename         input filename</span>
00120 <span class="comment">/// @param ITEMBUFFER       pointer to buffer for storing a transaction</span>
00121 <span class="comment">/// @param IS_ASCII         true if file is in ASCII format</span>
00122 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00123"></a><a class="code" href="classInputData.html#a9">00123</a> <span class="comment"></span><a class="code" href="group__InputOutput.html#a9">InputData::InputData</a>(<span class="keywordtype">char</span> *filename, <span class="keywordtype">int</span> *ITEMBUFFER, <span class="keywordtype">bool</span> IS_ASCII) {
00124     <span class="keywordflow">if</span> (IS_ASCII)
00125         <a class="code" href="classInputData.html#InputDatao0">inputFile</a>.open(filename);
00126     <span class="keywordflow">else</span>
00127         <a class="code" href="classInputData.html#InputDatao0">inputFile</a>.open(filename, ios::binary);
00128 
00129     <a class="code" href="classInputData.html#InputDatam1">isAsciiFile</a> = IS_ASCII;
00130     <a class="code" href="classInputData.html#InputDatam0">itembuffer</a> = ITEMBUFFER;
00131 }
00132 <span class="comment"></span>
00133 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00134 <span class="comment">/// Close the input file</span>
00135 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00136"></a><a class="code" href="classInputData.html#a10">00136</a> <span class="comment"></span><a class="code" href="group__InputOutput.html#a10">InputData::~InputData</a>() {
00137     <a class="code" href="classInputData.html#InputDatao0">inputFile</a>.close();
00138 }
00139 <span class="comment"></span>
00140 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00141 <span class="comment">/// Check if the input file is open</span>
00142 <span class="comment">///</span>
00143 <span class="comment">/// @return true if file is open</span>
00144 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00145"></a><a class="code" href="classInputData.html#a11">00145</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="group__InputOutput.html#a11">InputData::isOpen</a>() {
00146     <span class="keywordflow">return</span> <a class="code" href="classInputData.html#InputDatao0">inputFile</a>.is_open();
00147 }<span class="comment"></span>
00148 <span class="comment">/** @} */</span>
</pre></div><hr><address style="align: right;"><small>Generated on Thu Dec 4 15:22:06 2003 for MAFIA by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
