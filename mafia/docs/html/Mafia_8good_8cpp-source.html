<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Mafia.good.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>Mafia.good.cpp</h1><a href="Mafia_8good_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 2003, Cornell University</span>
00004 <span class="comment">All rights reserved.</span>
00005 <span class="comment"></span>
00006 <span class="comment">Redistribution and use in source and binary forms, with or without</span>
00007 <span class="comment">modification, are permitted provided that the following conditions are met:</span>
00008 <span class="comment"></span>
00009 <span class="comment">  - Redistributions of source code must retain the above copyright notice,</span>
00010 <span class="comment">      this list of conditions and the following disclaimer.</span>
00011 <span class="comment">  - Redistributions in binary form must reproduce the above copyright</span>
00012 <span class="comment">      notice, this list of conditions and the following disclaimer in the</span>
00013 <span class="comment">      documentation and/or other materials provided with the distribution.</span>
00014 <span class="comment">  - Neither the name of Cornell University nor the names of its</span>
00015 <span class="comment">      contributors may be used to endorse or promote products derived from</span>
00016 <span class="comment">      this software without specific prior written permission.</span>
00017 <span class="comment"></span>
00018 <span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"</span>
00019 <span class="comment">AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
00020 <span class="comment">IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
00021 <span class="comment">ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
00022 <span class="comment">LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
00023 <span class="comment">CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
00024 <span class="comment">SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
00025 <span class="comment">INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
00026 <span class="comment">CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
00027 <span class="comment">ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF</span>
00028 <span class="comment">THE POSSIBILITY OF SUCH DAMAGE.</span>
00029 <span class="comment"></span>
00030 <span class="comment">*/</span>
00031 <span class="comment"></span>
00032 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00033 <span class="comment"></span><span class="comment">//</span>
00034 <span class="comment">// Mafia.cpp</span>
00035 <span class="comment">//</span><span class="comment"></span>
00036 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00037 <span class="comment"></span>
<a name="l00038"></a><a class="code" href="Mafia_8good_8cpp.html#a0">00038</a> <span class="preprocessor">#define DEBUG</span>
00039 <span class="preprocessor"></span>
00040 <span class="preprocessor">#include &lt;iostream&gt;</span>
00041 <span class="preprocessor">#include &lt;fstream&gt;</span>
00042 <span class="preprocessor">#include &lt;time.h&gt;</span>
00043 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00044 <span class="preprocessor">#include &lt;list&gt;</span>
00045 <span class="preprocessor">#include &lt;vector&gt;</span>
00046 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00047 <span class="preprocessor">#include &lt;string&gt;</span>
00048 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00049 <span class="preprocessor">#include &lt;math.h&gt;</span>
00050 <span class="preprocessor">#include &lt;map&gt;</span>
00051 <span class="preprocessor">#include "<a class="code" href="Bitmap_8h.html">Bitmap.h</a>"</span>
00052 <span class="preprocessor">#include "<a class="code" href="TreeNode_8h.html">TreeNode.h</a>"</span>
00053 <span class="preprocessor">#include "<a class="code" href="Transaction_8h.html">Transaction.h</a>"</span>
00054 <span class="preprocessor">#include "<a class="code" href="ItemsetOutput_8h.html">ItemsetOutput.h</a>"</span>
00055 
00056 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00057 <span class="comment"></span>
00058 <span class="comment">/// @defgroup GlobalVariables Global Variables</span>
00059 <span class="comment">/// Global variables</span>
00060 <span class="comment"></span><span class="comment">/** @{ */</span>
<a name="l00061"></a><a class="code" href="Mafia_8good_8cpp.html#a1">00061</a> <span class="keyword">typedef</span> vector&lt;TreeNode *&gt; <a class="code" href="Mafia_8good_8cpp.html#a1">NodeList</a>;
<a name="l00062"></a><a class="code" href="Mafia_8good_8cpp.html#a2">00062</a> <span class="keyword">typedef</span> vector&lt;TreeNode *&gt; <a class="code" href="Mafia_8good_8cpp.html#a2">BranchList</a>;
<a name="l00063"></a><a class="code" href="Mafia_8good_8cpp.html#a3">00063</a> <span class="keyword">typedef</span> vector&lt;Bitmap *&gt; <a class="code" href="Mafia_8good_8cpp.html#a3">BitmapList</a>;
<a name="l00064"></a><a class="code" href="Mafia_8good_8cpp.html#a4">00064</a> <span class="keyword">typedef</span> vector&lt;BaseBitmap *&gt; <a class="code" href="Mafia_8good_8cpp.html#a4">BaseBitmapList</a>;
<a name="l00065"></a><a class="code" href="Mafia_8good_8cpp.html#a5">00065</a> <span class="keyword">typedef</span> vector&lt;int&gt; <a class="code" href="Mafia_8good_8cpp.html#a5">ItemSet</a>;
<a name="l00066"></a><a class="code" href="Mafia_8good_8cpp.html#a6">00066</a> <span class="keyword">typedef</span> map&lt;long, ItemSet *&gt; <a class="code" href="Mafia_8good_8cpp.html#a6">HashTable</a>;
00067 <span class="comment"></span>
00068 <span class="comment">/// Simple class for storing subtree size estimates</span>
00069 <span class="comment"></span><span class="keyword">class </span><a class="code" href="classSubtreeEstimate.html">SubtreeEstimate</a> {
00070 <span class="keyword">public</span>:
<a name="l00071"></a><a class="code" href="classSubtreeEstimate.html#m0">00071</a>     <span class="keywordtype">int</span> <a class="code" href="classSubtreeEstimate.html#m0">Count</a>;              <span class="comment">///&lt; Count of actual subtrees counted</span>
<a name="l00072"></a><a class="code" href="classSubtreeEstimate.html#m1">00072</a> <span class="comment"></span>    <span class="keywordtype">int</span> <a class="code" href="classSubtreeEstimate.html#m1">Sum</a>;                <span class="comment">///&lt; Sum of subtree sizes</span>
<a name="l00073"></a><a class="code" href="classSubtreeEstimate.html#a1">00073</a> <span class="comment"></span>    <a class="code" href="classSubtreeEstimate.html#a0">SubtreeEstimate</a> () {
00074         <a class="code" href="classSubtreeEstimate.html#m0">Count</a> = 0;
00075         <a class="code" href="classSubtreeEstimate.html#m1">Sum</a> = 0;
00076     }
00077 };
00078 <span class="comment"></span>
00079 <span class="comment">/// Simple class for storing tail elements of each node of the tree</span>
00080 <span class="comment"></span><span class="keyword">class </span><a class="code" href="classTailElement.html">TailElement</a> {
00081 <span class="keyword">public</span>:
<a name="l00082"></a><a class="code" href="classTailElement.html#m0">00082</a>     <span class="keywordtype">int</span> <a class="code" href="classTailElement.html#m0">Count</a>;              <span class="comment">///&lt; Support of the 1-extension</span>
<a name="l00083"></a><a class="code" href="classTailElement.html#m1">00083</a> <span class="comment"></span>    <span class="keywordtype">int</span> <a class="code" href="classTailElement.html#m1">Item</a>;               <span class="comment">///&lt; Item-id for this1 -extension</span>
00084 <span class="comment"></span>    
<a name="l00085"></a><a class="code" href="classTailElement.html#a2">00085</a>     <a class="code" href="classTailElement.html#a0">TailElement</a> () {
00086         <a class="code" href="classTailElement.html#m0">Count</a> = 0;
00087         <a class="code" href="classTailElement.html#m1">Item</a> = 0;
00088     }
00089     
<a name="l00090"></a><a class="code" href="classTailElement.html#a3">00090</a>     <span class="keywordtype">bool</span> <a class="code" href="classTailElement.html#a1">operator &lt; </a>(<span class="keyword">const</span> <a class="code" href="classTailElement.html">TailElement</a>&amp; rhs)<span class="keyword"> const </span>{
00091         <span class="keywordflow">return</span> this-&gt;<a class="code" href="classTailElement.html#m0">Count</a> &lt; rhs.<a class="code" href="classTailElement.html#m0">Count</a>;
00092     };
00093 };
00094 <span class="comment"></span>
00095 <span class="comment">/// @defgroup CommandLineParameters Command Line Parameters/Variables</span>
00096 <span class="comment">/// Commmand line parameters from user or inferred</span>
00097 <span class="comment"></span><span class="comment">/** @{ */</span>
<a name="l00098"></a><a class="code" href="Mafia_8good_8cpp.html#a7">00098</a> string <a class="code" href="Mafia_8good_8cpp.html#a7">method</a>;               <span class="comment">///&lt; either -mfi or -fci or -fi</span>
<a name="l00099"></a><a class="code" href="Mafia_8good_8cpp.html#a8">00099</a> <span class="comment"></span><span class="keywordtype">char</span>* <a class="code" href="Mafia_8good_8cpp.html#a8">outFilename</a>;           <span class="comment">///&lt; filename for output</span>
<a name="l00100"></a><a class="code" href="Mafia_8good_8cpp.html#a9">00100</a> <span class="comment"></span><a class="code" href="classItemsetOutput.html">ItemsetOutput</a> *<a class="code" href="Mafia_8good_8cpp.html#a9">outFile</a>;      <span class="comment">///&lt; file for ouput</span>
<a name="l00101"></a><a class="code" href="Mafia_8good_8cpp.html#a10">00101</a> <span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="Mafia_8good_8cpp.html#a10">outputMFI</a> = <span class="keyword">false</span>;      <span class="comment">///&lt; true if MFI should be saved to a file</span>
<a name="l00102"></a><a class="code" href="Mafia_8good_8cpp.html#a11">00102</a> <span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="Mafia_8good_8cpp.html#a11">MethodIsFI</a> = <span class="keyword">false</span>;     <span class="comment">///&lt; true if the method is -fi</span>
<a name="l00103"></a><a class="code" href="Mafia_8good_8cpp.html#a12">00103</a> <span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="Mafia_8good_8cpp.html#a12">MethodIsFCI</a> = <span class="keyword">false</span>;    <span class="comment">///&lt; true if the method is -fci</span>
<a name="l00104"></a><a class="code" href="Mafia_8good_8cpp.html#a13">00104</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a13">ItemCount</a>;               <span class="comment">///&lt; # of items in the file</span>
<a name="l00105"></a><a class="code" href="Mafia_8good_8cpp.html#a14">00105</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a>;              <span class="comment">///&lt; # of transactions in the file</span>
<a name="l00106"></a><a class="code" href="Mafia_8good_8cpp.html#a15">00106</a> <span class="comment"></span><span class="keywordtype">double</span> <a class="code" href="Mafia_8good_8cpp.html#a15">MSF</a>;                  <span class="comment">///&lt; user-defined min sup as percentage</span>
<a name="l00107"></a><a class="code" href="Mafia_8good_8cpp.html#a16">00107</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a16">MS</a>;                      <span class="comment">///&lt; min sup as a transaction count</span>
<a name="l00108"></a><a class="code" href="Mafia_8good_8cpp.html#a17">00108</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a17">VerScale</a> = 1;            <span class="comment">///&lt; Scaling factor for transactions</span>
<a name="l00109"></a><a class="code" href="Mafia_8good_8cpp.html#a18">00109</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a18">HorScale</a> = 1;            <span class="comment">///&lt; Scaling factor for items</span>
<a name="l00110"></a><a class="code" href="Mafia_8good_8cpp.html#a19">00110</a> <span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="Mafia_8good_8cpp.html#a19">GoFHUT</a> = <span class="keyword">true</span>;          <span class="comment">///&lt; FHUT flag</span>
<a name="l00111"></a><a class="code" href="Mafia_8good_8cpp.html#a20">00111</a> <span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="Mafia_8good_8cpp.html#a20">HUTMFI</a> = <span class="keyword">true</span>;          <span class="comment">///&lt; HUTMFI flag</span>
<a name="l00112"></a><a class="code" href="Mafia_8good_8cpp.html#a21">00112</a> <span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="Mafia_8good_8cpp.html#a21">PEPrune</a> = <span class="keyword">true</span>;         <span class="comment">///&lt; PEPrune flag -- parent equivalent pruning</span>
<a name="l00113"></a><a class="code" href="Mafia_8good_8cpp.html#a22">00113</a> <span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="Mafia_8good_8cpp.html#a22">Reorder</a> = <span class="keyword">true</span>;         <span class="comment">///&lt; Reorder flag</span>
00114 <span class="comment"></span><span class="comment">/** @} */</span>
00115 
00116 <span class="comment"></span>
00117 <span class="comment">/// @defgroup CounterVariables Counter Variables</span>
00118 <span class="comment">/// Counter variables for information gathering</span>
00119 <span class="comment"></span><span class="comment">/** @{ */</span>
<a name="l00120"></a><a class="code" href="Mafia_8good_8cpp.html#a23">00120</a> <span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a23">CountFHUT</a> = 0;           <span class="comment">///&lt; # of times FHUT was successful</span>
<a name="l00121"></a><a class="code" href="Mafia_8good_8cpp.html#a24">00121</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a24">CountNodes</a> = 0;          <span class="comment">///&lt; # of frequent nodes in the tree</span>
<a name="l00122"></a><a class="code" href="Mafia_8good_8cpp.html#a25">00122</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a25">CountCounts</a> = 0;         <span class="comment">///&lt; # of Counts or all nodes in the tree</span>
<a name="l00123"></a><a class="code" href="Mafia_8good_8cpp.html#a26">00123</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a26">CountAnds</a> = 0;           <span class="comment">///&lt; # of ANDs of normal bitmaps</span>
<a name="l00124"></a><a class="code" href="Mafia_8good_8cpp.html#a27">00124</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a27">CountSmallAnds</a> = 0;      <span class="comment">///&lt; # of compressed bitmap ANDs</span>
<a name="l00125"></a><a class="code" href="Mafia_8good_8cpp.html#a28">00125</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a28">CountPEPrunes</a> = 0;         <span class="comment">///&lt; # of PEPruning</span>
<a name="l00126"></a><a class="code" href="Mafia_8good_8cpp.html#a29">00126</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a29">CountCheckPosition</a> = 0;  <span class="comment">///&lt; # of CheckPosition calls</span>
<a name="l00127"></a><a class="code" href="Mafia_8good_8cpp.html#a30">00127</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a30">CountHUTMFI</a> = 0;         <span class="comment">///&lt; # of HUTMFI attempts</span>
<a name="l00128"></a><a class="code" href="Mafia_8good_8cpp.html#a31">00128</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a31">CountHUTMFISuccess</a> = 0;  <span class="comment">///&lt; # of HUTMFI successes</span>
<a name="l00129"></a><a class="code" href="Mafia_8good_8cpp.html#a32">00129</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a32">CountRebuilds</a>;           <span class="comment">///&lt; # of Rebuilds</span>
00130 <span class="comment"></span><span class="comment">/** @} */</span>
00131 
00132 <span class="comment"></span>
00133 <span class="comment">/// @defgroup ProgramVariables Program Parameters/Variables</span>
00134 <span class="comment">/// Useful program parameters/counters</span>
00135 <span class="comment"></span><span class="comment">/** @{ */</span>
<a name="l00136"></a><a class="code" href="Mafia_8good_8cpp.html#a33">00136</a> <span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a33">maxtail</a> = 0;
<a name="l00137"></a><a class="code" href="Mafia_8good_8cpp.html#a34">00137</a> <span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a34">MFISize</a> = 0;             <span class="comment">///&lt; MFI size before pruning</span>
<a name="l00138"></a><a class="code" href="Mafia_8good_8cpp.html#a35">00138</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a35">MFIDepth</a> = 0;            <span class="comment">///&lt; The aggregated depth of the all MFI elements</span>
<a name="l00139"></a><a class="code" href="Mafia_8good_8cpp.html#a36">00139</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a36">F1size</a> = 0;              <span class="comment">///&lt; # of frequent 1-itemsets after merging repeats</span>
<a name="l00140"></a><a class="code" href="Mafia_8good_8cpp.html#a37">00140</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a> = 0;          <span class="comment">///&lt; # of frequent 1-itemsets</span>
<a name="l00141"></a><a class="code" href="Mafia_8good_8cpp.html#a38">00141</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a38">k</a> = 50;                  <span class="comment">///&lt; # of items checked for a MFI lookup</span>
<a name="l00142"></a><a class="code" href="Mafia_8good_8cpp.html#a39">00142</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a39">MAX_compID</a> = 1;          <span class="comment">///&lt; max compression ID</span>
<a name="l00143"></a><a class="code" href="Mafia_8good_8cpp.html#a40">00143</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a40">projectDepth</a> = -1;       <span class="comment">///&lt; depth of the bitmap you're projecting from</span>
<a name="l00144"></a><a class="code" href="Mafia_8good_8cpp.html#a41">00144</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a41">EstimateSize</a>;            <span class="comment">///&lt; size of subtree estimation buffer</span>
<a name="l00145"></a><a class="code" href="Mafia_8good_8cpp.html#a42">00145</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a42">EstimateDiv</a> = 5;         <span class="comment">///&lt; bucket size by frequent tail length</span>
<a name="l00146"></a><a class="code" href="Mafia_8good_8cpp.html#a43">00146</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a43">maxItemsetSize</a> = 0;      <span class="comment">///&lt; max size of a frequent itemset</span>
00147 <span class="comment"></span><span class="comment">/** @} */</span>
00148 
00149 <span class="comment"></span>
00150 <span class="comment">/// @defgroup DataVariables Data variables</span>
00151 <span class="comment">/// Complex data structure variables</span>
00152 <span class="comment"></span><span class="comment">/** @{ */</span>
<a name="l00153"></a><a class="code" href="Mafia_8good_8cpp.html#a44">00153</a> <a class="code" href="Mafia_8good_8cpp.html#a1">NodeList</a> <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>;                 <span class="comment">///&lt; List of frequent 1-itemsets</span>
<a name="l00154"></a><a class="code" href="Mafia_8good_8cpp.html#a45">00154</a> <span class="comment"></span><a class="code" href="Mafia_8good_8cpp.html#a3">BitmapList</a> <a class="code" href="Mafia_8good_8cpp.html#a45">TransBuffy</a>;       <span class="comment">///&lt; Buffer of transaction bitmaps</span>
<a name="l00155"></a><a class="code" href="Mafia_8good_8cpp.html#a46">00155</a> <span class="comment"></span><a class="code" href="Mafia_8good_8cpp.html#a4">BaseBitmapList</a> <a class="code" href="Mafia_8good_8cpp.html#a46">NameBuffy</a>;    <span class="comment">///&lt; Buffer of name bitmaps</span>
<a name="l00156"></a><a class="code" href="Mafia_8good_8cpp.html#a47">00156</a> <span class="comment"></span><a class="code" href="Mafia_8good_8cpp.html#a1">NodeList</a> <a class="code" href="Mafia_8good_8cpp.html#a47">NodeBuffy</a>;          <span class="comment">///&lt; Buffer of tree nodess</span>
<a name="l00157"></a><a class="code" href="Mafia_8good_8cpp.html#a48">00157</a> <span class="comment"></span><a class="code" href="classTreeNode.html">TreeNode</a> *<a class="code" href="Mafia_8good_8cpp.html#a48">Root</a>;              <span class="comment">///&lt; The root (the nullset)</span>
<a name="l00158"></a><a class="code" href="Mafia_8good_8cpp.html#a49">00158</a> <span class="comment"></span><a class="code" href="classTailElement.html">TailElement</a> *<a class="code" href="Mafia_8good_8cpp.html#a49">gTail</a>;          <span class="comment">///&lt; global tail pointer</span>
<a name="l00159"></a><a class="code" href="Mafia_8good_8cpp.html#a50">00159</a> <span class="comment"></span><a class="code" href="classTailElement.html">TailElement</a> *<a class="code" href="Mafia_8good_8cpp.html#a50">TailBuffy</a>;      <span class="comment">///&lt; Common Buffer for tail elements</span>
<a name="l00160"></a><a class="code" href="Mafia_8good_8cpp.html#a51">00160</a> <span class="comment"></span><a class="code" href="classBitmap.html">Bitmap</a> *<a class="code" href="Mafia_8good_8cpp.html#a51">NullTrans</a>;           <span class="comment">///&lt; A transaction bitmap filled with ones</span>
<a name="l00161"></a><a class="code" href="Mafia_8good_8cpp.html#a52">00161</a> <span class="comment"></span><span class="keywordtype">int</span> *<a class="code" href="Mafia_8good_8cpp.html#a52">ItemMap</a>;                <span class="comment">///&lt; For renaming items after sorting by support</span>
<a name="l00162"></a><a class="code" href="Mafia_8good_8cpp.html#a53">00162</a> <span class="comment"></span><span class="keywordtype">int</span> *<a class="code" href="Mafia_8good_8cpp.html#a53">ReverseItemMap</a>;         <span class="comment">///&lt; For remembering the renaming...</span>
<a name="l00163"></a><a class="code" href="Mafia_8good_8cpp.html#a54">00163</a> <span class="comment"></span><a class="code" href="Mafia_8good_8cpp.html#a4">BaseBitmapList</a> <a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>;          <span class="comment">///&lt; List of Maximally Frequent Itemsets</span>
<a name="l00164"></a><a class="code" href="Mafia_8good_8cpp.html#a55">00164</a> <span class="comment"></span><a class="code" href="Mafia_8good_8cpp.html#a6">HashTable</a> <a class="code" href="Mafia_8good_8cpp.html#a55">HT</a>;                <span class="comment">///&lt; Hash table of transaction supports</span>
<a name="l00165"></a><a class="code" href="Mafia_8good_8cpp.html#a56">00165</a> <span class="comment"></span>vector &lt;int&gt; <a class="code" href="Mafia_8good_8cpp.html#a56">SupportCountList</a>;       <span class="comment">///&lt; List that stores support count</span>
<a name="l00166"></a><a class="code" href="Mafia_8good_8cpp.html#a57">00166</a> <span class="comment"></span><a class="code" href="classBaseBitmap.html">BaseBitmap</a>* <a class="code" href="Mafia_8good_8cpp.html#a57">TempName</a>;        <span class="comment">///&lt; Temporary buffer for one name bitmap</span>
<a name="l00167"></a><a class="code" href="Mafia_8good_8cpp.html#a58">00167</a> <span class="comment"></span><a class="code" href="classSubtreeEstimate.html">SubtreeEstimate</a>* <a class="code" href="Mafia_8good_8cpp.html#a58">EstimateBuffy</a>;      <span class="comment">///&lt; Buffer of subtree estimates</span>
<a name="l00168"></a><a class="code" href="Mafia_8good_8cpp.html#a59">00168</a> <span class="comment"></span><span class="keywordtype">int</span> *<a class="code" href="Mafia_8good_8cpp.html#a59">MFIBySizes</a>;             <span class="comment">///&lt; Buffer for counting MFI by itemset size</span>
<a name="l00169"></a><a class="code" href="Mafia_8good_8cpp.html#a60">00169</a> <span class="comment"></span><span class="keywordtype">int</span> *<a class="code" href="Mafia_8good_8cpp.html#a60">ItemsetBuffy</a>;           <span class="comment">///&lt; Buffer for writing itemsets to file output</span>
00170 <span class="comment"></span><span class="comment">/** @} */</span>
00171 
00172 <span class="comment"></span>
00173 <span class="comment">/// @defgroup TimingVariables Timing Variables</span>
00174 <span class="comment">/// Variables for timing (and instrumenting the code)</span>
00175 <span class="comment"></span><span class="comment">/** @{ */</span>
<a name="l00176"></a><a class="code" href="Mafia_8good_8cpp.html#a61">00176</a> time_t <a class="code" href="Mafia_8good_8cpp.html#a61">total_start</a>, <a class="code" href="Mafia_8good_8cpp.html#a62">total_finish</a>;
<a name="l00177"></a><a class="code" href="Mafia_8good_8cpp.html#a63">00177</a> <span class="keywordtype">double</span> <a class="code" href="Mafia_8good_8cpp.html#a63">total_time</a>;
<a name="l00178"></a><a class="code" href="Mafia_8good_8cpp.html#a64">00178</a> time_t <a class="code" href="Mafia_8good_8cpp.html#a64">read_start</a>, <a class="code" href="Mafia_8good_8cpp.html#a65">read_finish</a>;
<a name="l00179"></a><a class="code" href="Mafia_8good_8cpp.html#a66">00179</a> <span class="keywordtype">double</span> <a class="code" href="Mafia_8good_8cpp.html#a66">read_time</a>;
<a name="l00180"></a><a class="code" href="Mafia_8good_8cpp.html#a67">00180</a> time_t <a class="code" href="Mafia_8good_8cpp.html#a67">algorithm_start</a>, <a class="code" href="Mafia_8good_8cpp.html#a68">algorithm_finish</a>;
<a name="l00181"></a><a class="code" href="Mafia_8good_8cpp.html#a69">00181</a> <span class="keywordtype">double</span> <a class="code" href="Mafia_8good_8cpp.html#a69">algorithm_time</a>;
<a name="l00182"></a><a class="code" href="Mafia_8good_8cpp.html#a70">00182</a> time_t <a class="code" href="Mafia_8good_8cpp.html#a70">print_start</a>, <a class="code" href="Mafia_8good_8cpp.html#a71">print_finish</a>;
<a name="l00183"></a><a class="code" href="Mafia_8good_8cpp.html#a72">00183</a> <span class="keywordtype">double</span> <a class="code" href="Mafia_8good_8cpp.html#a72">print_time</a>;<span class="comment"></span>
00184 <span class="comment">/** @} */</span><span class="comment"></span>
00185 <span class="comment">/** @} */</span>
00186 
00187 <span class="comment">/*********************************************************************</span>
00188 <span class="comment"> Reading the data in and building the item bitmaps</span>
00189 <span class="comment">*********************************************************************/</span> <span class="comment"></span>
00190 <span class="comment">/// @defgroup InputOutput Input/Output Functions</span>
00191 <span class="comment">/// Reading the data in and building the item bitmaps.</span>
00192 <span class="comment">/// Outputting the frequent itemsets.</span>
00193 <span class="comment"></span><span class="comment">/** @{ */</span>
00194 <span class="comment"></span>
00195 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00196 <span class="comment">/// Insert pointer to node in order of increasing support</span>
00197 <span class="comment">///</span>
00198 <span class="comment">/// @param newNode           item node to add to F1</span>
00199 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00200"></a><a class="code" href="Mafia_8good_8cpp.html#a73">00200</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="Mafia_8good_8cpp.html#a73">AddToF1</a>(<a class="code" href="classTreeNode.html">TreeNode</a> *newNode) {
00201     <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.empty())
00202         <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.push_back(newNode);
00203     <span class="keywordflow">else</span> {
00204         <span class="comment">// use insertion sort for increasing support ordering</span>
00205         NodeList::iterator noli = <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.begin();
00206         <span class="keywordflow">while</span> (noli != <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.end()) {
00207             <span class="keywordflow">if</span> ((*noli)-&gt;Trans-&gt;_count &gt;= newNode-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>) {
00208                 <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.insert(noli, newNode);
00209                 <span class="keywordflow">return</span> ;
00210             }
00211             noli++;
00212         }
00213 
00214         <span class="comment">// Add to end of F1 list</span>
00215         <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.push_back(newNode);
00216     }
00217 }
00218 <span class="comment"></span>
00219 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00220 <span class="comment">/// Create bitmaps filled randomly with probability p</span>
00221 <span class="comment">///</span>
00222 <span class="comment">/// @param P - probability of a bit p being set</span>
00223 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00224"></a><a class="code" href="Mafia_8good_8cpp.html#a74">00224</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="Mafia_8good_8cpp.html#a74">F1UsingProb</a>(<span class="keywordtype">double</span> P) {
00225     <span class="keywordtype">int</span> blah = 0;
00226     <span class="comment">//cout &lt;&lt; "Creating bitmap with prob p=" &lt;&lt; P &lt;&lt; endl;</span>
00227 
00228     <span class="comment">// Create frequent 1-itemsets with probability p</span>
00229     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Mafia_8good_8cpp.html#a13">ItemCount</a> / <a class="code" href="Mafia_8good_8cpp.html#a18">HorScale</a>; i++) {
00230         <span class="comment">// Create random transaction bitmap</span>
00231         <a class="code" href="classBitmap.html">Bitmap</a> *trans = <span class="keyword">new</span> <a class="code" href="classBitmap.html">Bitmap</a>(<a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a>);
00232         trans-&gt;<a class="code" href="group__BitmapProcessing.html#a3">FillRand</a>(P);
00233 
00234         <span class="comment">// Add frequent items to list</span>
00235         <span class="keywordflow">if</span> (trans-&gt;<a class="code" href="classBitmap.html#l0">Count</a>(blah) &gt;= <a class="code" href="Mafia_8good_8cpp.html#a16">MS</a>) {
00236             <a class="code" href="classTreeNode.html">TreeNode</a> *node = <span class="keyword">new</span> <a class="code" href="classTreeNode.html">TreeNode</a>(NULL, trans, 1, -1, i, -1, 0);
00237             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r = 0; r &lt; <a class="code" href="Mafia_8good_8cpp.html#a18">HorScale</a>; r++)
00238                 <a class="code" href="Mafia_8good_8cpp.html#a73">AddToF1</a>(node);
00239         } <span class="keywordflow">else</span>
00240             <span class="keyword">delete</span> trans;
00241     }
00242 }
00243 <span class="comment"></span>
00244 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00245 <span class="comment">/// Read transaction data from file and build item bitmaps.</span>
00246 <span class="comment">///     If the data is in ascii form:</span>
00247 <span class="comment">///     [itemid_1] [itemid_2] ... [itemid_n]</span>
00248 <span class="comment">///     If the data is in binary form:</span>
00249 <span class="comment">///     [custid] [transid] [number of items] [itemid_1] [itemid_2] ... [itemid_n]</span>
00250 <span class="comment">///</span>
00251 <span class="comment">/// @param filename          name of file to be read in</span>
00252 <span class="comment">/// @param isAsciiFile       true for ASCII input, false for binary</span>
00253 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00254"></a><a class="code" href="Mafia_8good_8cpp.html#a75">00254</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="Mafia_8good_8cpp.html#a75">F1FromFile</a>(<span class="keywordtype">char</span> *filename, <span class="keywordtype">bool</span> isAsciiFile) {
00255     <a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a> = 0;
00256     <span class="keywordtype">int</span> MAXitemID = -1;
00257     <span class="keywordtype">int</span> *Counters = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="Transaction_8h.html#a0">MAX_NUM_ITEMS</a>];        <span class="comment">//to count the support of items</span>
00258     <span class="keywordtype">int</span> *F1IndexList = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="Transaction_8h.html#a0">MAX_NUM_ITEMS</a>];     <span class="comment">// the id's of F1 items</span>
00259     <span class="keywordtype">int</span> *InvF1IndexList = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="Transaction_8h.html#a0">MAX_NUM_ITEMS</a>];
00260     <span class="keywordtype">int</span> itemIndex = 0;
00261 
00262     <span class="comment">//Initialize counters</span>
00263     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ct = 0; ct &lt; <a class="code" href="Transaction_8h.html#a0">MAX_NUM_ITEMS</a>; ++ct) {
00264         Counters[ct] = 0;
00265         F1IndexList[ct] = -1;
00266         InvF1IndexList[ct] = -1;
00267     }
00268 
00269     time(&amp;<a class="code" href="Mafia_8good_8cpp.html#a64">read_start</a>);
00270     <a class="code" href="Mafia_8good_8cpp.html#a3">BitmapList</a> Trans;
00271 
00272     <span class="keywordtype">int</span> *itemlist = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="Transaction_8h.html#a0">MAX_NUM_ITEMS</a>];
00273     <a class="code" href="classInputData.html">InputData</a> *inData = <span class="keyword">new</span> <a class="code" href="classInputData.html">InputData</a>(filename, itemlist, isAsciiFile);
00274     <span class="keywordflow">if</span> (!inData-&gt;<a class="code" href="group__InputOutput.html#a13">isOpen</a>()) {
00275         cerr &lt;&lt; <span class="stringliteral">"Input file not found!"</span> &lt;&lt; endl;
00276         exit(1);
00277     }
00278 
00279     <a class="code" href="classTransaction.html">Transaction</a> *newTransaction = inData-&gt;<a class="code" href="group__InputOutput.html#a10">getNextTransaction</a>();
00280     <span class="keywordflow">while</span> (newTransaction != NULL) {
00281         <span class="keywordflow">for</span> (itemIndex = 0; itemIndex &lt; newTransaction-&gt;<a class="code" href="classTransaction.html#m0">length</a>; itemIndex++) {
00282             <span class="comment">// ensure that there are not too many items</span>
00283             <span class="keywordflow">if</span> (newTransaction-&gt;<a class="code" href="classTransaction.html#m1">itemlist</a>[itemIndex] &gt;= <a class="code" href="Transaction_8h.html#a0">MAX_NUM_ITEMS</a>) {
00284                 cerr &lt;&lt; <span class="stringliteral">"Read item_id="</span> &lt;&lt; newTransaction-&gt;<a class="code" href="classTransaction.html#m1">itemlist</a>[itemIndex]
00285                 &lt;&lt; <span class="stringliteral">" which is more than the max item_id allowed ("</span> &lt;&lt; <a class="code" href="Transaction_8h.html#a0">MAX_NUM_ITEMS</a> &lt;&lt; <span class="stringliteral">")"</span>;
00286                 exit(1);
00287             }
00288 
00289             <span class="keywordflow">if</span> (newTransaction-&gt;<a class="code" href="classTransaction.html#m1">itemlist</a>[itemIndex] &gt; MAXitemID)
00290                 MAXitemID = newTransaction-&gt;<a class="code" href="classTransaction.html#m1">itemlist</a>[itemIndex];
00291 
00292             Counters[newTransaction-&gt;<a class="code" href="classTransaction.html#m1">itemlist</a>[itemIndex]]++;
00293         }
00294 
00295         <a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a>++;
00296         <span class="keyword">delete</span> newTransaction;
00297         newTransaction = inData-&gt;<a class="code" href="group__InputOutput.html#a10">getNextTransaction</a>();
00298     }
00299 
00300     <span class="keyword">delete</span> newTransaction;
00301     <span class="keyword">delete</span> inData;
00302 
00303     <a class="code" href="Mafia_8good_8cpp.html#a16">MS</a> = (int)ceil(<a class="code" href="Mafia_8good_8cpp.html#a15">MSF</a> * (<span class="keywordtype">double</span>)<a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a>);
00304     <span class="comment">//MSF = MS/(double)TransCount;</span>
00305 
00306     <a class="code" href="Mafia_8good_8cpp.html#a13">ItemCount</a> = MAXitemID + 1;
00307 
00308     <span class="keywordtype">int</span> F1items = 0;
00309     <span class="comment">// build the normal bitmaps -- Preallocated memory for the bitmaps</span>
00310     <span class="keywordflow">for</span> (itemIndex = 0; itemIndex &lt;= MAXitemID; itemIndex++) {
00311         <span class="keywordflow">if</span> (Counters[itemIndex] &gt;= <a class="code" href="Mafia_8good_8cpp.html#a16">MS</a>) {
00312             F1IndexList[F1items++] = itemIndex;
00313             InvF1IndexList[itemIndex] = F1items - 1;
00314             <a class="code" href="classBitmap.html">Bitmap</a> *trans = <span class="keyword">new</span> <a class="code" href="classBitmap.html">Bitmap</a>(<a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a>);
00315             trans-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a> = Counters[itemIndex];
00316             Trans.push_back(trans);
00317         }
00318     }
00319 
00320     <span class="keywordtype">int</span> transIndex = 0;
00321     InputData *inData2 = <span class="keyword">new</span> InputData(filename, itemlist, isAsciiFile);
00322     newTransaction = inData2-&gt;<a class="code" href="group__InputOutput.html#a10">getNextTransaction</a>();
00323     <span class="keywordflow">while</span> (newTransaction != NULL) {
00324         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> itemIndex = 0; itemIndex &lt; newTransaction-&gt;<a class="code" href="classTransaction.html#m0">length</a>; itemIndex++) {
00325             <span class="keywordflow">if</span> (InvF1IndexList[newTransaction-&gt;<a class="code" href="classTransaction.html#m1">itemlist</a>[itemIndex]] != -1) {
00326                 Trans[InvF1IndexList[newTransaction-&gt;<a class="code" href="classTransaction.html#m1">itemlist</a>[itemIndex]]]-&gt;FillEmptyPosition(transIndex);
00327             }
00328         }
00329 
00330         transIndex++;
00331         <span class="keyword">delete</span> newTransaction;
00332         newTransaction = inData2-&gt;<a class="code" href="group__InputOutput.html#a10">getNextTransaction</a>();
00333     }
00334 
00335     <span class="keyword">delete</span> newTransaction;
00336     <span class="keyword">delete</span> inData2;
00337     <span class="keyword">delete</span> [] itemlist;
00338 
00339     time(&amp;<a class="code" href="Mafia_8good_8cpp.html#a65">read_finish</a>);
00340     <a class="code" href="Mafia_8good_8cpp.html#a66">read_time</a> = difftime(<a class="code" href="Mafia_8good_8cpp.html#a65">read_finish</a>, <a class="code" href="Mafia_8good_8cpp.html#a64">read_start</a>);
00341     printf(<span class="stringliteral">"Reading input time: %.2f seconds.\n"</span>, <a class="code" href="Mafia_8good_8cpp.html#a66">read_time</a>);
00342 
00343     <span class="comment">// Create F1</span>
00344     BitmapList::iterator bli = Trans.begin();
00345     itemIndex = 0;
00346 
00347     <span class="keywordflow">while</span> (bli != Trans.end()) {
00348         <a class="code" href="classTreeNode.html">TreeNode</a> *node = <span class="keyword">new</span> <a class="code" href="classTreeNode.html">TreeNode</a>(
00349                              NULL,
00350                              (*bli),
00351                              1,
00352                              -1,
00353                              F1IndexList[itemIndex],
00354                              -1,
00355                              0);
00356         <a class="code" href="Mafia_8good_8cpp.html#a73">AddToF1</a>(node);
00357         bli++;
00358         itemIndex++;
00359     }
00360 
00361     <span class="keyword">delete</span> [] Counters;
00362     <span class="keyword">delete</span> [] F1IndexList;
00363     <span class="keyword">delete</span> [] InvF1IndexList;
00364 }
00365 <span class="comment"></span>
00366 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00367 <span class="comment">/// To print the MFI data out to an ASCII file</span>
00368 <span class="comment">///     with each entry having the format:</span>
00369 <span class="comment">///     [list of items in MFI entry...] [(support)]</span>
00370 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00371"></a><a class="code" href="Mafia_8good_8cpp.html#a76">00371</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="group__InputOutput.html#a3">PrintMFI</a>() {
00372     <span class="comment">// open output file</span>
00373     outFile = <span class="keyword">new</span> <a class="code" href="classItemsetOutput.html">ItemsetOutput</a>(<a class="code" href="Mafia_8good_8cpp.html#a8">outFilename</a>);
00374     <span class="keywordflow">if</span> (!outFile-&gt;<a class="code" href="group__InputOutput.html#a8">isOpen</a>()) {
00375         cerr &lt;&lt; <span class="stringliteral">"Output file not open!"</span> &lt;&lt; endl;
00376         exit(1);
00377     }
00378 
00379     <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a> != 0) {
00380         <span class="comment">// translate bitmap to list of INTs</span>
00381         <span class="keywordtype">int</span>* ITEMS = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a>];
00382         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Mafia_8good_8cpp.html#a34">MFISize</a>; i++) {
00383             <span class="keywordtype">int</span> j = 0;
00384             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cc = 0; cc &lt; <a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a>; cc++) {
00385                 <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>[i]-&gt;CheckPosition(cc, <a class="code" href="Mafia_8good_8cpp.html#a29">CountCheckPosition</a>) &gt; 0) {
00386                     ITEMS[j] = <a class="code" href="Mafia_8good_8cpp.html#a52">ItemMap</a>[cc];
00387                     j++;
00388                 }
00389             }
00390 
00391             outFile-&gt;<a class="code" href="group__InputOutput.html#a9">printSet</a>(<a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>[i]-&gt;_count, ITEMS, <a class="code" href="Mafia_8good_8cpp.html#a56">SupportCountList</a>[i]);
00392         }
00393         <span class="keyword">delete</span> [] ITEMS;
00394     } <span class="keywordflow">else</span> {
00395         outFile-&gt;<a class="code" href="group__InputOutput.html#a9">printSet</a>(0, NULL, <a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a>);
00396     }
00397 
00398     <span class="keyword">delete</span> outFile;
00399 }
00400 
<a name="l00401"></a><a class="code" href="group__InputOutput.html#a4">00401</a> <span class="keywordtype">void</span> <a class="code" href="group__InputOutput.html#a4">cerrMFI</a>() {
00402     <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a> != 0) {
00403         <span class="comment">// translate bitmap to list of INTs</span>
00404         <span class="keywordtype">int</span>* ITEMS = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a>];
00405         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="Mafia_8good_8cpp.html#a34">MFISize</a>; i++) {
00406             <span class="keywordtype">int</span> j = 0;
00407             cerr &lt;&lt; <span class="stringliteral">"MFI i="</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">":"</span>;
00408             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cc = 0; cc &lt; <a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a>; cc++) {
00409                 <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>[i]-&gt;CheckPosition(cc, <a class="code" href="Mafia_8good_8cpp.html#a29">CountCheckPosition</a>) &gt; 0) {
00410                     cerr &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; cc;
00411                     j++;
00412                 }
00413             }
00414 
00415             cerr &lt;&lt; endl;
00416         }
00417         <span class="keyword">delete</span> [] ITEMS;
00418     }
00419 }
00420 
<a name="l00421"></a><a class="code" href="group__InputOutput.html#a5">00421</a> <span class="keywordtype">void</span> <a class="code" href="group__InputOutput.html#a5">PrintItemset</a>(<a class="code" href="classBaseBitmap.html">BaseBitmap</a> *printSet) {
00422     <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a> != 0) {
00423         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cc = 0; cc &lt; <a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a>; cc++) {
00424             <span class="keywordflow">if</span> (printSet-&gt;<a class="code" href="classBaseBitmap.html#a12">CheckPosition</a>(cc, <a class="code" href="Mafia_8good_8cpp.html#a29">CountCheckPosition</a>) &gt; 0) {
00425                 cerr &lt;&lt; cc &lt;&lt; <span class="stringliteral">" "</span>;
00426             }
00427         }
00428         cerr &lt;&lt; endl;
00429     }
00430 }<span class="comment"></span>
00431 <span class="comment">/** @} */</span>
00432 
00433 
00434 <span class="comment">/*********************************************************************</span>
00435 <span class="comment"> Algorithmic components</span>
00436 <span class="comment">*********************************************************************/</span> <span class="comment"></span>
00437 <span class="comment">/// @defgroup AlgorithmicComponents Algorithmic Component Functions</span>
00438 <span class="comment">/// Algorithm components (HUTMFI, PEP, etc.)</span>
00439 <span class="comment"></span><span class="comment">/** @{ */</span>
00440 <span class="comment"></span>
00441 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00442 <span class="comment">/// Check for an existing superset of name in the MFI</span>
00443 <span class="comment">///</span>
00444 <span class="comment">/// @param location          The node we're at.  Use this to examine only</span>
00445 <span class="comment">///                          the relevant portion of the MFI</span>
00446 <span class="comment">/// @return True - if superset found.</span>
00447 <span class="comment">///         False - if no superset.</span>
00448 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00449"></a><a class="code" href="Mafia_8good_8cpp.html#a79">00449</a> <span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="Mafia_8good_8cpp.html#a79">LMFISuperSet</a>(<a class="code" href="classTreeNode.html">TreeNode</a>* location) {
00450     <span class="keywordflow">return</span> (location-&gt;<a class="code" href="classTreeNode.html#m7">rEnd</a> &gt; location-&gt;<a class="code" href="classTreeNode.html#m6">rBegin</a>);
00451 }
00452 <span class="comment"></span>
00453 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00454 <span class="comment">/// Output itemset (don't need to save bitmaps for FI)</span>
00455 <span class="comment">///</span>
00456 <span class="comment">/// @param C                 the current node</span>
00457 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00458"></a><a class="code" href="Mafia_8good_8cpp.html#a80">00458</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="Mafia_8good_8cpp.html#a80">AddToFI</a>(<a class="code" href="classTreeNode.html">TreeNode</a> *C) {
00459     <span class="keywordtype">int</span> itemsetIndex = 0;
00460     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cc = 0; cc &lt; <a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a>; cc++) {
00461         <span class="keywordflow">if</span> (C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>-&gt;<a class="code" href="classBaseBitmap.html#a12">CheckPosition</a>(cc, <a class="code" href="Mafia_8good_8cpp.html#a29">CountCheckPosition</a>) &gt; 0) {
00462             <a class="code" href="Mafia_8good_8cpp.html#a60">ItemsetBuffy</a>[itemsetIndex] = <a class="code" href="Mafia_8good_8cpp.html#a52">ItemMap</a>[cc];
00463             itemsetIndex++;
00464         }
00465     }
00466 
00467     <a class="code" href="Mafia_8good_8cpp.html#a59">MFIBySizes</a>[C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>]++;
00468     <span class="keywordflow">if</span> (C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a> &gt; <a class="code" href="Mafia_8good_8cpp.html#a43">maxItemsetSize</a>)
00469         <a class="code" href="Mafia_8good_8cpp.html#a43">maxItemsetSize</a> = C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>;
00470 
00471     <span class="keywordflow">if</span> (outputMFI)
00472         outFile-&gt;<a class="code" href="group__InputOutput.html#a9">printSet</a>(C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>, <a class="code" href="Mafia_8good_8cpp.html#a60">ItemsetBuffy</a>, C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>);
00473 
00474     <span class="comment">// Update stat variables</span>
00475     <a class="code" href="Mafia_8good_8cpp.html#a35">MFIDepth</a> += C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>;
00476     <a class="code" href="Mafia_8good_8cpp.html#a34">MFISize</a>++;
00477 }
00478 <span class="comment"></span>
00479 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00480 <span class="comment">/// Add this node's name bitmap to the MFI list</span>
00481 <span class="comment">///</span>
00482 <span class="comment">/// @param C                 the current node</span>
00483 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00484"></a><a class="code" href="Mafia_8good_8cpp.html#a81">00484</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="Mafia_8good_8cpp.html#a81">AddToMFI</a>(<a class="code" href="classTreeNode.html">TreeNode</a> *C) {
00485     <span class="comment">// copy name bitmap</span>
00486     <a class="code" href="classBaseBitmap.html">BaseBitmap</a> *name = <span class="keyword">new</span> <a class="code" href="classBaseBitmap.html">BaseBitmap</a>(*C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>);
00487 
00488     <span class="comment">// add to MFI</span>
00489     <a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>.push_back(name);
00490 
00491     <span class="comment">// update the end of the relevant</span>
00492     C-&gt;<a class="code" href="classTreeNode.html#m7">rEnd</a>++;
00493 
00494     <span class="comment">// Update stat variables</span>
00495     <a class="code" href="Mafia_8good_8cpp.html#a35">MFIDepth</a> += C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>;
00496     <a class="code" href="Mafia_8good_8cpp.html#a34">MFISize</a>++;
00497 
00498     <a class="code" href="Mafia_8good_8cpp.html#a56">SupportCountList</a>.push_back(C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>);
00499     <a class="code" href="Mafia_8good_8cpp.html#a59">MFIBySizes</a>[name-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>]++;
00500     <span class="keywordflow">if</span> (name-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a> &gt; <a class="code" href="Mafia_8good_8cpp.html#a43">maxItemsetSize</a>)
00501         <a class="code" href="Mafia_8good_8cpp.html#a43">maxItemsetSize</a> = name-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>;
00502 }
00503 <span class="comment"></span>
00504 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00505 <span class="comment">/// Add this node's name bitmap to the FCI list</span>
00506 <span class="comment">///</span>
00507 <span class="comment">/// @param C                 the current node</span>
00508 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00509"></a><a class="code" href="Mafia_8good_8cpp.html#a82">00509</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="Mafia_8good_8cpp.html#a82">AddToFCI</a>(<a class="code" href="classTreeNode.html">TreeNode</a> *C) {
00510     <span class="comment">// Search HT</span>
00511     HashTable::iterator h = <a class="code" href="Mafia_8good_8cpp.html#a55">HT</a>.find(C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>);
00512 
00513     <span class="comment">// If the support of node C is NOT in HashSup</span>
00514     <span class="keywordflow">if</span> (h == <a class="code" href="Mafia_8good_8cpp.html#a55">HT</a>.end()) {
00515         <span class="comment">// Add a new list to the HashSup</span>
00516         <a class="code" href="Mafia_8good_8cpp.html#a5">ItemSet</a>* newList = <span class="keyword">new</span> <a class="code" href="Mafia_8good_8cpp.html#a5">ItemSet</a>();
00517         newList-&gt;reserve(500);
00518         newList-&gt;push_back(<a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>.size());
00519         <a class="code" href="Mafia_8good_8cpp.html#a55">HT</a>.insert(HashTable::value_type(C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>, newList));
00520 
00521         <span class="comment">// Else add pointer to last item in iName to HT entry</span>
00522     } <span class="keywordflow">else</span> {
00523         <span class="keywordflow">for</span> (ItemSet::reverse_iterator goli = (*h).second-&gt;rbegin();
00524                 goli != (*h).second-&gt;rend();
00525                 goli++)
00526             <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>[*goli]-&gt;Superset(C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>))
00527                 <span class="keywordflow">return</span> ;
00528 
00529         <span class="comment">// search the table</span>
00530         (*h).second-&gt;push_back(<a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>.size());
00531     }
00532 
00533     <span class="comment">// copy name bitmap</span>
00534     <a class="code" href="classBaseBitmap.html">BaseBitmap</a> *name = <span class="keyword">new</span> <a class="code" href="classBaseBitmap.html">BaseBitmap</a>(*C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>);
00535 
00536     <span class="comment">// add to MFI</span>
00537     <a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>.push_back(name);
00538 
00539     <span class="comment">// Update stat variables</span>
00540     <a class="code" href="Mafia_8good_8cpp.html#a35">MFIDepth</a> += C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>;
00541     <a class="code" href="Mafia_8good_8cpp.html#a34">MFISize</a>++;
00542 
00543     <a class="code" href="Mafia_8good_8cpp.html#a56">SupportCountList</a>.push_back(C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>);
00544     <a class="code" href="Mafia_8good_8cpp.html#a59">MFIBySizes</a>[name-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>]++;
00545     <span class="keywordflow">if</span> (name-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a> &gt; <a class="code" href="Mafia_8good_8cpp.html#a43">maxItemsetSize</a>)
00546         <a class="code" href="Mafia_8good_8cpp.html#a43">maxItemsetSize</a> = name-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>;
00547 }
00548 
<a name="l00549"></a><a class="code" href="Mafia_8good_8cpp.html#a83">00549</a> <span class="keywordtype">int</span> <a class="code" href="Mafia_8good_8cpp.html#a83">SortLMFI</a>(<span class="keywordtype">int</span> rBegin, <span class="keywordtype">int</span> rEnd, <span class="keywordtype">int</span> sortBy) {
00550     <span class="keywordtype">int</span> o = rBegin;
00551     <span class="keywordtype">int</span> p = rEnd - 1;
00552     <span class="keywordflow">while</span> ( o &lt;= p) {
00553         <span class="keywordflow">while</span> (o &lt; rEnd &amp;&amp; !<a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>[o]-&gt;CheckPosition(sortBy, <a class="code" href="Mafia_8good_8cpp.html#a29">CountCheckPosition</a>))
00554             o++;
00555         <span class="keywordflow">while</span> (p &gt;= rBegin &amp;&amp; <a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>[p]-&gt;CheckPosition(sortBy, <a class="code" href="Mafia_8good_8cpp.html#a29">CountCheckPosition</a>))
00556             p--;
00557         <span class="keywordflow">if</span> (o &lt; p) {
00558             <span class="comment">// we are now at a point where MFI[o] is relevant</span>
00559             <span class="comment">// and MFI[p] is not since o &lt; p, we swap the two</span>
00560             <a class="code" href="classBaseBitmap.html">BaseBitmap</a>* tempBitmap = <a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>[o];
00561             MFI[o] = MFI[p];
00562             MFI[p] = tempBitmap;
00563             tempBitmap = NULL;
00564             o++;
00565             p--;
00566         }
00567     }
00568     <span class="comment">// the first relevant one for the next node is o</span>
00569     <span class="keywordflow">return</span> o;
00570 }
00571 
00572 <span class="comment"></span>
00573 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00574 <span class="comment">/// Determine whether a HUTMFI is true.</span>
00575 <span class="comment">///     - if HUT is in MFI, then HUT is frequent</span>
00576 <span class="comment">///     and the subtree rooted at this node can be pruned</span>
00577 <span class="comment">///</span>
00578 <span class="comment">/// @return True if HUT is in the MFI</span>
00579 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00580"></a><a class="code" href="Mafia_8good_8cpp.html#a84">00580</a> <span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="Mafia_8good_8cpp.html#a84">CheckHUTMFI</a>(<a class="code" href="classTreeNode.html">TreeNode</a> *C, <span class="keywordtype">int</span> iTAIL) {
00581 
00582     <span class="comment">// for each element i in the tail form {head} U {i} and check for a</span>
00583     <span class="comment">//     superset in the MFI</span>
00584     <span class="keywordtype">int</span> rBegin = C-&gt;<a class="code" href="classTreeNode.html#m6">rBegin</a>;
00585     <span class="keywordtype">int</span> rEnd = C-&gt;<a class="code" href="classTreeNode.html#m7">rEnd</a>; 
00586     <span class="keywordflow">for</span> (; iTAIL &lt; C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a>; iTAIL++) {        
00587         rBegin = <a class="code" href="Mafia_8good_8cpp.html#a83">SortLMFI</a>(rBegin, rEnd, <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[iTAIL].Item]-&gt;Prefix);        
00588            
00589         <span class="keywordflow">if</span> (rEnd &lt;= rBegin)
00590             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00591     }
00592 
00593     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00594 }
00595 
00596 <span class="comment"></span>
00597 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00598 <span class="comment">/// Dynamically reorder the elements in the tail by increasing support</span>
00599 <span class="comment">///    - Expand all children and sort by increasing support</span>
00600 <span class="comment">///    - Remove infrequent children</span>
00601 <span class="comment">///</span>
00602 <span class="comment">/// @param C                 current node</span>
00603 <span class="comment">/// @param iTAIL             index into tail of current node</span>
00604 <span class="comment">/// @param useComp           whether compressed bitmaps should be used</span>
00605 <span class="comment">/// @param NoChild           whether C has any frequent children</span>
00606 <span class="comment">/// @param AllFreq           whether all children are frequent</span>
00607 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00608"></a><a class="code" href="Mafia_8good_8cpp.html#a85">00608</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="Mafia_8good_8cpp.html#a85">ReorderTail</a>(
00609     <a class="code" href="classTreeNode.html">TreeNode</a> *C,
00610     <span class="keywordtype">int</span> &amp;iTAIL,
00611     <span class="keywordtype">bool</span> useComp,
00612     <span class="keywordtype">bool</span> &amp;NoChild,
00613     <span class="keywordtype">bool</span> &amp;AllFreq) {
00614 
00615     <span class="keywordtype">int</span> tailIndex = 0;
00616     <span class="keywordtype">int</span> lol = 0;
00617     <span class="comment">// for each tail element</span>
00618     <span class="keywordflow">for</span> (lol = iTAIL; lol &lt; C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a>; lol++) {
00619         <a class="code" href="classBitmap.html">Bitmap</a> *trans = <a class="code" href="Mafia_8good_8cpp.html#a45">TransBuffy</a>[C-&gt;<a class="code" href="classTreeNode.html#m2">Depth</a>];
00620         <span class="keywordtype">int</span> theCount = 0;
00621 
00622         <span class="comment">// Compress the bitmaps</span>
00623         <span class="keywordflow">if</span> (useComp &amp;&amp; (<a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[lol].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;compID != C-&gt;<a class="code" href="classTreeNode.html#m3">compID</a>)) {
00624             <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[lol].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;Trans-&gt;BuildRelComp(
00625                 *TransBuffy[<a class="code" href="Mafia_8good_8cpp.html#a40">projectDepth</a>]);
00626             <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[lol].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;compID = C-&gt;<a class="code" href="classTreeNode.html#m3">compID</a>;
00627             <a class="code" href="Mafia_8good_8cpp.html#a32">CountRebuilds</a>++;
00628         }
00629 
00630         <span class="comment">// Use the compressed bitmaps</span>
00631         <span class="keywordflow">if</span> (useComp) {
00632             <span class="comment">// AND the compressed bitmaps and count the result</span>
00633             trans-&gt;<a class="code" href="group__BitmapProcessing.html#a16">AndCompOnly</a>(
00634                 *C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>,
00635                 *<a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[lol].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;Trans,
00636                 <a class="code" href="Mafia_8good_8cpp.html#a27">CountSmallAnds</a>);
00637             theCount = trans-&gt;<a class="code" href="group__BitmapProcessing.html#a15">SmallCount</a>(<a class="code" href="Mafia_8good_8cpp.html#a25">CountCounts</a>);
00638 
00639             <span class="comment">// use the full bitmaps</span>
00640         } <span class="keywordflow">else</span> {
00641             <span class="comment">// AND &amp; count the bitmaps</span>
00642             trans-&gt;<a class="code" href="group__BitmapProcessing.html#a7">AndOnly</a>(*C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>, *<a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[lol].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;Trans, <a class="code" href="Mafia_8good_8cpp.html#a26">CountAnds</a>);
00643             theCount = trans-&gt;<a class="code" href="classBitmap.html#l0">Count</a>(<a class="code" href="Mafia_8good_8cpp.html#a25">CountCounts</a>);
00644         }
00645 
00646         <span class="comment">// If the results is frequent</span>
00647         <span class="keywordflow">if</span> (theCount &gt;= <a class="code" href="Mafia_8good_8cpp.html#a16">MS</a>) {
00648             <span class="comment">// if PEP pruning holds</span>
00649             <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a21">PEPrune</a> &amp;&amp; (trans-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a> == C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>)) {
00650                 <span class="comment">// Move tail element from tail to head</span>
00651                 C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>-&gt;<a class="code" href="group__BitmapProcessing.html#a6">Or</a>(*C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>, *<a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[lol].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;Name);
00652                 <a class="code" href="Mafia_8good_8cpp.html#a28">CountPEPrunes</a>++;
00653 
00654                 <span class="comment">// add tail element to reordered tail</span>
00655             } <span class="keywordflow">else</span> {
00656                 NoChild = <span class="keyword">false</span>;
00657 
00658                 <span class="comment">// create new tail element</span>
00659                 TailBuffy[tailIndex].<a class="code" href="classTailElement.html#m0">Count</a> = theCount;
00660                 TailBuffy[tailIndex].<a class="code" href="classTailElement.html#m1">Item</a> = gTail[lol].<a class="code" href="classTailElement.html#m1">Item</a>;
00661                 tailIndex++;
00662             }
00663         } <span class="keywordflow">else</span>
00664             AllFreq = <span class="keyword">false</span>;
00665     }
00666 
00667     sort(TailBuffy, TailBuffy + tailIndex);
00668 
00669     <span class="comment">// Set the begin and end values of the new tail</span>
00670     iTAIL = C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a>;
00671     C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a> = iTAIL + tailIndex;
00672     C-&gt;<a class="code" href="classTreeNode.html#m4">tBegin</a> = iTAIL;
00673     <span class="keywordtype">int</span> r = 0;
00674 
00675     <span class="comment">// Copy new tail into next slots</span>
00676     <span class="keywordflow">for</span> (lol = iTAIL; lol &lt; C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a>; lol++) {
00677         gTail[lol] = TailBuffy[r];
00678         r++;
00679     }
00680 }
00681 <span class="comment"></span>
00682 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00683 <span class="comment">/// Simply copy over the tail without expanding any of the children</span>
00684 <span class="comment">///    for pure DFS (no expansion of all children)</span>
00685 <span class="comment">///</span>
00686 <span class="comment">/// @param C                 current node</span>
00687 <span class="comment">/// @param iTAIL             index into tail of current node</span>
00688 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00689"></a><a class="code" href="Mafia_8good_8cpp.html#a86">00689</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="Mafia_8good_8cpp.html#a86">NoorderTail</a>(
00690     <a class="code" href="classTreeNode.html">TreeNode</a> *C,
00691     <span class="keywordtype">int</span> &amp;iTAIL) {
00692 
00693     <span class="comment">// set begin and end tail pointers</span>
00694     iTAIL = C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a>;
00695     C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a> = C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a> - C-&gt;<a class="code" href="classTreeNode.html#m4">tBegin</a> + C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a>;
00696     C-&gt;<a class="code" href="classTreeNode.html#m4">tBegin</a> = iTAIL;
00697     <span class="keywordtype">int</span> r = 0;
00698 
00699     <span class="comment">// copy over old tail to new tail</span>
00700     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> lol = iTAIL; lol &lt; C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a>; lol++) {
00701         gTail[lol] = gTail[lol - C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a> + C-&gt;<a class="code" href="classTreeNode.html#m4">tBegin</a>];
00702         r++;
00703     }
00704 }
00705 
00706 <span class="comment"></span>
00707 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00708 <span class="comment">/// The main MAFIA algorithm function</span>
00709 <span class="comment">///</span>
00710 <span class="comment">/// @param C                 the current node</span>
00711 <span class="comment">/// @param HUT               whether this is a HUT check (left most branch)</span>
00712 <span class="comment">/// @param FHUT              [output] whether the HUT is frequent</span>
00713 <span class="comment">/// @param useComp           if compression has been switched on</span>
00714 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00715"></a><a class="code" href="Mafia_8good_8cpp.html#a87">00715</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="Mafia_8good_8cpp.html#a87">MAFIA</a>(<a class="code" href="classTreeNode.html">TreeNode</a> *C, <span class="keywordtype">bool</span> HUT, <span class="keywordtype">bool</span> &amp;FHUT, <span class="keywordtype">bool</span> useComp) {
00716     <a class="code" href="Mafia_8good_8cpp.html#a24">CountNodes</a>++;
00717     <span class="keywordtype">int</span> iTAIL = C-&gt;<a class="code" href="classTreeNode.html#m4">tBegin</a>;   <span class="comment">// index into the tail</span>
00718     <span class="keywordtype">bool</span> NoChild = <span class="keyword">true</span>;     <span class="comment">// whether the node has any frequent children</span>
00719     <span class="keywordtype">bool</span> AllFreq = <span class="keyword">true</span>;     <span class="comment">// whether all the children are frequent</span>
00720     FHUT = <span class="keyword">false</span>;            <span class="comment">// whether this is a FHUT</span>
00721     <span class="keywordtype">int</span> beforeCountNodes = <a class="code" href="Mafia_8good_8cpp.html#a24">CountNodes</a>;
00722     <span class="keywordtype">int</span> frequentTailSize = C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a> - iTAIL;
00723 
00724     <span class="keywordflow">if</span> (iTAIL &lt; C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a>) {
00725         <span class="comment">/*// Check if a superset of the HUT is in the MFI</span>
00726 <span class="comment">        if ((C == Root) &amp;&amp; (HUTMFI)) {</span>
00727 <span class="comment">            CountHUTMFI++;</span>
00728 <span class="comment">            if (CheckHUTMFI(C, C-&gt;tBegin)) {</span>
00729 <span class="comment">                // stop generation of subtree from this node</span>
00730 <span class="comment">                CountHUTMFISuccess++;</span>
00731 <span class="comment">                return ;</span>
00732 <span class="comment">            }</span>
00733 <span class="comment">        }*/</span>
00734 
00735         <span class="keywordflow">if</span> (C != Root)
00736             <span class="keywordflow">if</span> (Reorder)
00737                 <a class="code" href="Mafia_8good_8cpp.html#a85">ReorderTail</a>(C, iTAIL, useComp, NoChild, AllFreq);
00738             <span class="keywordflow">else</span>
00739                 <a class="code" href="Mafia_8good_8cpp.html#a86">NoorderTail</a>(C, iTAIL);
00740 
00741         frequentTailSize = C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a> - iTAIL;
00742 
00743         <span class="keywordtype">int</span> estimateTail = (int)(frequentTailSize / (double)<a class="code" href="Mafia_8good_8cpp.html#a42">EstimateDiv</a>);
00744         <span class="keywordflow">if</span> (estimateTail &gt; 0 &amp;&amp; C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a> != <a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a>) {
00745             <span class="keywordtype">double</span> estimateSubTree = EstimateBuffy[estimateTail].<a class="code" href="classSubtreeEstimate.html#m1">Sum</a> / (double)EstimateBuffy[estimateTail].<a class="code" href="classSubtreeEstimate.html#m0">Count</a>;
00746             <span class="keywordtype">double</span> support = C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a> / (double) <a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a>;
00747             <span class="keywordtype">double</span> factor = 11.597 - 29.914 * (support - .52392) * (support - .52392);
00748             <span class="keywordtype">double</span> cost = factor * frequentTailSize / (1 - support);
00749 
00750             <span class="comment">// check if relative comp should be performed</span>
00751             <span class="keywordflow">if</span> ((!useComp) &amp;&amp; (estimateSubTree &gt; cost)) {
00752 
00753                 <span class="comment">// build the relative bitmap for source [node bitmap] (all 1's)</span>
00754                 C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>-&gt;<a class="code" href="group__BitmapProcessing.html#a19">BuildSource</a>();
00755 
00756                 <span class="comment">// remember the depth of the FULL bitmap your projecting from</span>
00757                 <a class="code" href="Mafia_8good_8cpp.html#a40">projectDepth</a> = C-&gt;<a class="code" href="classTreeNode.html#m2">Depth</a> - 1;
00758 
00759                 <span class="comment">// increment the ID</span>
00760                 C-&gt;<a class="code" href="classTreeNode.html#m3">compID</a> = <a class="code" href="Mafia_8good_8cpp.html#a39">MAX_compID</a>;
00761                 <a class="code" href="Mafia_8good_8cpp.html#a39">MAX_compID</a>++;
00762                 useComp = <span class="keyword">true</span>;
00763             }
00764         }
00765 
00766         <span class="comment">// Candidate generation - extend the Head with the tail elements</span>
00767         <span class="comment">// We start from the end of the tail and move backwards</span>
00768         <span class="comment">// Therefore the tail is iterated through in increasing support,</span>
00769         <span class="comment">// but is stored in decreasing support.</span>
00770         <span class="keywordflow">while</span> (iTAIL &lt; C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a>) {
00771             <span class="comment">// form a one-extension</span>
00772             <a class="code" href="classBitmap.html">Bitmap</a> *trans = <a class="code" href="Mafia_8good_8cpp.html#a45">TransBuffy</a>[C-&gt;<a class="code" href="classTreeNode.html#m2">Depth</a>];
00773             <a class="code" href="classBaseBitmap.html">BaseBitmap</a> *name = <a class="code" href="Mafia_8good_8cpp.html#a46">NameBuffy</a>[C-&gt;<a class="code" href="classTreeNode.html#m2">Depth</a>];
00774             <a class="code" href="classTreeNode.html">TreeNode</a> *node = <a class="code" href="Mafia_8good_8cpp.html#a47">NodeBuffy</a>[C-&gt;<a class="code" href="classTreeNode.html#m2">Depth</a>];
00775 
00776             <span class="comment">// create name for the new node</span>
00777             name-&gt;<a class="code" href="group__BitmapProcessing.html#a6">Or</a>(*C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>, *<a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[iTAIL].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;Name);
00778 
00779             <span class="comment">// compress the bitmaps if warranted</span>
00780             <span class="keywordflow">if</span> (useComp &amp;&amp; (<a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[iTAIL].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;compID != C-&gt;<a class="code" href="classTreeNode.html#m3">compID</a>)) {
00781                 <span class="comment">// build the relative for this node</span>
00782                 <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[iTAIL].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;Trans-&gt;BuildRelComp(
00783                     *TransBuffy[<a class="code" href="Mafia_8good_8cpp.html#a40">projectDepth</a>]);
00784                 <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[iTAIL].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;compID = C-&gt;<a class="code" href="classTreeNode.html#m3">compID</a>;
00785                 <a class="code" href="Mafia_8good_8cpp.html#a32">CountRebuilds</a>++;
00786             }
00787             
00788             <span class="keywordtype">int</span> theCount = 0;
00789 
00790             <span class="comment">// use the compressed bitmaps for ANDing and counting</span>
00791             <span class="keywordflow">if</span> (useComp) {
00792                 <span class="comment">// AND and count small bitmaps</span>
00793                 trans-&gt;<a class="code" href="group__BitmapProcessing.html#a16">AndCompOnly</a>(
00794                     *C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>,
00795                     *<a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[iTAIL].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;Trans,
00796                     <a class="code" href="Mafia_8good_8cpp.html#a27">CountSmallAnds</a>);
00797 
00798                 <span class="keywordflow">if</span> (Reorder)
00799                     trans-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a> = gTail[iTAIL].<a class="code" href="classTailElement.html#m0">Count</a>;
00800                 <span class="keywordflow">else</span>
00801                     theCount = trans-&gt;<a class="code" href="group__BitmapProcessing.html#a15">SmallCount</a>(<a class="code" href="Mafia_8good_8cpp.html#a25">CountCounts</a>);
00802             } <span class="keywordflow">else</span> {
00803                 <span class="comment">// AND and count the full bitmaps</span>
00804                 trans-&gt;<a class="code" href="group__BitmapProcessing.html#a7">AndOnly</a>(
00805                     *C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>,
00806                     *<a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[iTAIL].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;Trans,
00807                     <a class="code" href="Mafia_8good_8cpp.html#a26">CountAnds</a>);
00808 
00809                 <span class="keywordflow">if</span> (Reorder)
00810                     trans-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a> = gTail[iTAIL].<a class="code" href="classTailElement.html#m0">Count</a>;
00811                 <span class="keywordflow">else</span>
00812                     theCount = trans-&gt;<a class="code" href="classBitmap.html#l0">Count</a>(<a class="code" href="Mafia_8good_8cpp.html#a25">CountCounts</a>);
00813             }
00814             <span class="keywordflow">if</span> (!<a class="code" href="Mafia_8good_8cpp.html#a22">Reorder</a> &amp;&amp; <a class="code" href="Mafia_8good_8cpp.html#a21">PEPrune</a> &amp;&amp; (theCount == C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a>)) {
00815                 <a class="code" href="Mafia_8good_8cpp.html#a28">CountPEPrunes</a>++;
00816                 C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>-&gt;<a class="code" href="group__BitmapProcessing.html#a6">Or</a>(*C-&gt;<a class="code" href="classTreeNode.html#m0">Name</a>, *<a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[iTAIL].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;Name);
00817                 iTAIL++;
00818                 <span class="keywordflow">continue</span>;
00819             }
00820 
00821             <span class="comment">// Determine whether this candidate will be a HUT</span>
00822             <span class="comment">// Conceptually the leftmost branch of the tree is a HUT check</span>
00823             <span class="keywordflow">if</span> ((iTAIL != C-&gt;<a class="code" href="classTreeNode.html#m4">tBegin</a>) &amp;&amp; (C != Root))
00824                 HUT = 0;
00825             <span class="keywordflow">else</span>
00826                 HUT = 1;
00827                 
00828             <span class="keywordflow">if</span> (!AllFreq)
00829                 HUT = 0;
00830                 
00831             <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a22">Reorder</a> || (theCount &gt;= <a class="code" href="Mafia_8good_8cpp.html#a16">MS</a>)) {
00832                 <span class="comment">// form the 1-extension node</span>
00833                 node-&gt;<a class="code" href="classTreeNode.html#a2">setTreeNode</a>(name,
00834                                   trans,
00835                                   C-&gt;<a class="code" href="classTreeNode.html#m2">Depth</a> + 1,
00836                                   C-&gt;<a class="code" href="classTreeNode.html#m3">compID</a>,
00837                                   <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[gTail[iTAIL].<a class="code" href="classTailElement.html#m1">Item</a>]-&gt;Prefix,
00838                                   iTAIL + 1,
00839                                   C-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a>);
00840 
00841                 <span class="comment">// setup the LMFI for the next level; it contains all</span>
00842                 <span class="comment">// itemsets in LMFI for this level that also include the</span>
00843                 <span class="comment">// one we're extending the node with.  We do sort of a</span>
00844                 <span class="comment">// quicksort thing to move the relevant itemsets for the</span>
00845                 <span class="comment">// next node to the end of the portion of the MFI relevant</span>
00846                 <span class="comment">// to this node</span>
00847 
00848                 
00849                 node-&gt;<a class="code" href="classTreeNode.html#m7">rEnd</a> = C-&gt;<a class="code" href="classTreeNode.html#m7">rEnd</a>;                
00850                 node-&gt;<a class="code" href="classTreeNode.html#m6">rBegin</a> = <a class="code" href="Mafia_8good_8cpp.html#a83">SortLMFI</a>(C-&gt;<a class="code" href="classTreeNode.html#m6">rBegin</a>, C-&gt;<a class="code" href="classTreeNode.html#m7">rEnd</a>, node-&gt;<a class="code" href="classTreeNode.html#m8">Prefix</a>);                
00851 
00852                 <span class="comment">// Check for HUT in MFI for remaining tail</span>
00853                 <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a20">HUTMFI</a> &amp;&amp; node-&gt;<a class="code" href="classTreeNode.html#m4">tBegin</a> != node-&gt;<a class="code" href="classTreeNode.html#m5">tEnd</a> &amp;&amp; !HUT) {
00854                     <a class="code" href="Mafia_8good_8cpp.html#a30">CountHUTMFI</a>++;
00855 
00856                     <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a84">CheckHUTMFI</a>(node, node-&gt;<a class="code" href="classTreeNode.html#m4">tBegin</a>)) {
00857                         <span class="comment">// stop generation of extensions</span>
00858                         <a class="code" href="Mafia_8good_8cpp.html#a31">CountHUTMFISuccess</a>++;
00859                         AllFreq = <span class="keyword">false</span>;
00860                         <span class="keywordflow">break</span>;
00861                     }
00862                 }
00863 
00864                 NoChild = <span class="keyword">false</span>;
00865                 <span class="comment">// recurse down the tree</span>
00866                 <a class="code" href="Mafia_8good_8cpp.html#a87">MAFIA</a>(node, HUT, FHUT, useComp);
00867 
00868                 <span class="comment">// Add those discovered from lower levels to the current LMFI</span>
00869                 <span class="comment">// LMFI_l = LMFI_l \union LMFI_{l+1}</span>
00870                 <span class="comment">// all we need to do is to update the end pointer</span>
00871                 C-&gt;<a class="code" href="classTreeNode.html#m7">rEnd</a> = node-&gt;<a class="code" href="classTreeNode.html#m7">rEnd</a>;
00872             } <span class="keywordflow">else</span>
00873                 AllFreq = <span class="keyword">false</span>;
00874 
00875             <span class="comment">// if this was a successful HUT check</span>
00876             <span class="keywordflow">if</span> (FHUT) {
00877                 <span class="comment">// keep going up the tree</span>
00878                 <span class="keywordflow">if</span> (HUT) {
00879                     <span class="keywordflow">return</span> ;
00880 
00881                     <span class="comment">// reached start of HUT, so stop generation of subtree</span>
00882                     <span class="comment">// rooted at this node</span>
00883                 } <span class="keywordflow">else</span> {
00884                     FHUT = <span class="keyword">false</span>;
00885                     <span class="keywordflow">break</span>;
00886                 }
00887             }
00888 
00889             <span class="comment">// Move on the next tail element</span>
00890             iTAIL++;
00891         }
00892     }
00893 
00894     <span class="comment">// if this is a FHUT</span>
00895     <span class="keywordflow">if</span> (HUT &amp;&amp; AllFreq &amp;&amp; <a class="code" href="Mafia_8good_8cpp.html#a19">GoFHUT</a>) {
00896         FHUT = <span class="keyword">true</span>;
00897         <a class="code" href="Mafia_8good_8cpp.html#a23">CountFHUT</a>++;
00898     }
00899 
00900     <span class="comment">// if this node is childless and not in MFI</span>
00901     <span class="keywordflow">if</span> (MethodIsFI)
00902         <a class="code" href="Mafia_8good_8cpp.html#a80">AddToFI</a>(C);
00903     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a12">MethodIsFCI</a> &amp;&amp; C != Root)
00904         <a class="code" href="Mafia_8good_8cpp.html#a82">AddToFCI</a>(C);
00905     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NoChild &amp;&amp; !<a class="code" href="Mafia_8good_8cpp.html#a79">LMFISuperSet</a>(C)) {
00906         <a class="code" href="Mafia_8good_8cpp.html#a81">AddToMFI</a>(C);
00907     }
00908 
00909     <span class="keywordtype">int</span> subtreeSize = <a class="code" href="Mafia_8good_8cpp.html#a24">CountNodes</a> - beforeCountNodes + 1;
00910     <span class="keywordtype">int</span> estimateTail = (int)(frequentTailSize / (double)<a class="code" href="Mafia_8good_8cpp.html#a42">EstimateDiv</a>);
00911     <span class="keywordflow">if</span> (estimateTail &gt; 0 &amp;&amp; C-&gt;<a class="code" href="classTreeNode.html#m1">Trans</a>-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a> != <a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a>) {
00912         EstimateBuffy[estimateTail].<a class="code" href="classSubtreeEstimate.html#m0">Count</a>++;
00913         EstimateBuffy[estimateTail].<a class="code" href="classSubtreeEstimate.html#m1">Sum</a> += subtreeSize;
00914     }
00915 }
00916 
00917 <span class="comment"></span>
00918 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00919 <span class="comment">/// Merge repeated itemsets into one combined itemset</span>
00920 <span class="comment">///    - e.g. if (transaction set of item 4) AND</span>
00921 <span class="comment">///    (transaction set item 5) = (transaction set item 5),</span>
00922 <span class="comment">///    then item 5 is a duplicate of item 4</span>
00923 <span class="comment">///    due to increasing support</span>
00924 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00925"></a><a class="code" href="Mafia_8good_8cpp.html#a88">00925</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="group__AlgorithmicComponents.html#a9">MergeRepeatedItemsets</a>() {
00926     NodeList::iterator bali = <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.begin();
00927     <a class="code" href="classBitmap.html">Bitmap</a> out(*(*bali)-&gt;Trans);
00928     <span class="keywordtype">int</span> blah = 0;
00929 
00930     <span class="comment">// for each frequent 1-itemset</span>
00931     <span class="keywordflow">while</span> (bali != <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.end()) {
00932         out.<a class="code" href="group__BitmapProcessing.html#a4">FillOnes</a>();
00933         NodeList::iterator noli = bali;
00934         noli++;
00935 
00936         <span class="comment">// search for a copy of the itemset's transaction set</span>
00937         <span class="keywordflow">while</span> (noli != <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.end()) {
00938             <span class="comment">// stop when count is no longer the same</span>
00939             <span class="keywordflow">if</span> ((*bali)-&gt;Trans-&gt;_count != (*noli)-&gt;Trans-&gt;_count)
00940                 <span class="keywordflow">break</span>;
00941             <span class="keywordflow">else</span> {
00942                 <span class="comment">// AND itemsets with the same count</span>
00943                 out.<a class="code" href="group__BitmapProcessing.html#a7">AndOnly</a>(*(*bali)-&gt;Trans, *(*noli)-&gt;Trans, <a class="code" href="Mafia_8good_8cpp.html#a26">CountAnds</a>);
00944                 out.<a class="code" href="classBitmap.html#l0">Count</a>(blah);
00945 
00946                 <span class="comment">// check for a duplicate</span>
00947                 <span class="keywordflow">if</span> (out.<a class="code" href="classBaseBitmap.html#m1">_count</a> == (*noli)-&gt;Trans-&gt;_count) {
00948                     (*bali)-&gt;Name-&gt;Or(*(*bali)-&gt;Name, *(*noli)-&gt;Name);
00949                     <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.erase(noli);
00950                 } <span class="keywordflow">else</span>
00951                     noli++;
00952             }
00953         }
00954         bali++;
00955     }
00956 }<span class="comment"></span>
00957 <span class="comment">/** @} */</span>
00958 
00959 
00960 <span class="comment">/*********************************************************************</span>
00961 <span class="comment"> MAIN</span>
00962 <span class="comment">*********************************************************************/</span> <span class="comment"></span>
00963 <span class="comment">/// @defgroup MainFunction Main Function</span>
00964 <span class="comment">/// Main function for running the program</span>
00965 <span class="comment"></span><span class="comment">/** @{ */</span>
00966 <span class="comment"></span>
00967 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
00968 <span class="comment"></span><span class="comment">// main function for the program</span><span class="comment"></span>
00969 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
<a name="l00970"></a><a class="code" href="Mafia_8good_8cpp.html#a89">00970</a> <span class="comment"></span>int main(int argc, char **argv) {
00971     <span class="comment">// Check parameters</span>
00972 
00973     <span class="keywordflow">if</span> (argc &lt; 5) {
00974         cerr &lt;&lt; <span class="stringliteral">"Usage: "</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">" [-mfi/-fci/-fi] [min sup (percent)] "</span> &lt;&lt; endl;
00975         cerr &lt;&lt; <span class="stringliteral">"\t[-ascii/-binary] [input filename] "</span> &lt;&lt; endl;
00976         cerr &lt;&lt; <span class="stringliteral">"\t[output filename (optional)]"</span> &lt;&lt; endl;
00977         cerr &lt;&lt; <span class="stringliteral">"Ex: "</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">" -mfi .5 -ascii connect4.ascii mfi.txt"</span> &lt;&lt; endl;
00978         cerr &lt;&lt; <span class="stringliteral">"Ex: "</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">" -mfi .3 -binary chess.binary"</span> &lt;&lt; endl;
00979         exit(0);
00980     }
00981 
00982     <span class="comment">// time hook</span>
00983     time(&amp;<a class="code" href="Mafia_8good_8cpp.html#a61">total_start</a>);
00984 
00985     <span class="comment">// get the algorithm type</span>
00986     <a class="code" href="Mafia_8good_8cpp.html#a7">method</a> = argv[1];
00987 
00988     <span class="comment">// Minimum support as a number</span>
00989     <a class="code" href="Mafia_8good_8cpp.html#a15">MSF</a> = atof(argv[2]);
00990     <span class="keywordflow">if</span> (strcmp(argv[3], <span class="stringliteral">"-ascii"</span>) == 0)
00991         <a class="code" href="Mafia_8good_8cpp.html#a75">F1FromFile</a>(argv[4], <span class="keyword">true</span>);
00992     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[3], <span class="stringliteral">"-binary"</span>) == 0)
00993         <a class="code" href="Mafia_8good_8cpp.html#a75">F1FromFile</a>(argv[4], <span class="keyword">false</span>);
00994     <span class="keywordflow">else</span> {
00995         cerr &lt;&lt; <span class="stringliteral">"File format must be -ascii or -binary"</span> &lt;&lt; endl;
00996         exit(1);
00997     }
00998 
00999     <span class="keywordflow">if</span> (argc == 6) {
01000         <a class="code" href="Mafia_8good_8cpp.html#a10">outputMFI</a> = <span class="keyword">true</span>;
01001         <a class="code" href="Mafia_8good_8cpp.html#a8">outFilename</a> = argv[5];
01002     }
01003 
01004     <span class="comment">// Create a null node to begin the DFS tree</span>
01005     NullTrans = <span class="keyword">new</span> <a class="code" href="classBitmap.html">Bitmap</a>(<a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a>);
01006     NullTrans-&gt;<a class="code" href="group__BitmapProcessing.html#a4">FillOnes</a>();
01007     NullTrans-&gt;<a class="code" href="classBaseBitmap.html#m1">_count</a> = <a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a>;
01008     <a class="code" href="Mafia_8good_8cpp.html#a5">ItemSet</a> NullList;
01009 
01010     <a class="code" href="Mafia_8good_8cpp.html#a59">MFIBySizes</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="Transaction_8h.html#a1">MAX_ITEMSET_SIZE</a>];
01011     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> h = 0; h &lt; <a class="code" href="Transaction_8h.html#a1">MAX_ITEMSET_SIZE</a>; h++) {
01012         <a class="code" href="Mafia_8good_8cpp.html#a59">MFIBySizes</a>[h] = 0;
01013     }
01014 
01015     <span class="comment">// Set size of F1</span>
01016     <a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a> = <a class="code" href="Mafia_8good_8cpp.html#a36">F1size</a> = <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.size();
01017 
01018     <span class="comment">// if F1 is not empty</span>
01019     <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a> != 0) {
01020 
01021         <a class="code" href="classBaseBitmap.html">BaseBitmap</a> *NullName = <span class="keyword">new</span> <a class="code" href="classBaseBitmap.html">BaseBitmap</a>(<a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a>);
01022         <a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>.reserve(100000);
01023 
01024         <span class="keywordtype">int</span> p = 0;
01025         <a class="code" href="Mafia_8good_8cpp.html#a52">ItemMap</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a>];
01026         <a class="code" href="Mafia_8good_8cpp.html#a60">ItemsetBuffy</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a>];
01027 
01028         <span class="comment">// Rename items in F1</span>
01029         <span class="keywordflow">for</span> (NodeList::iterator nli = <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.begin(); nli != <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.end(); nli++) {
01030             <span class="comment">// store old itemid</span>
01031             <a class="code" href="Mafia_8good_8cpp.html#a52">ItemMap</a>[p] = (*nli)-&gt;Prefix;
01032 
01033             <span class="comment">// assign new itemid</span>
01034             (*nli)-&gt;Prefix = p;
01035 
01036             <span class="comment">// assign name bitmaps</span>
01037             (*nli)-&gt;Name = <span class="keyword">new</span> BaseBitmap(<a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a>);
01038             (*nli)-&gt;Name-&gt;FillEmptyPosition(p);
01039             (*nli)-&gt;Name-&gt;_count = 1;
01040             p++;
01041         }
01042 
01043         <span class="comment">// handle repeated itemsets</span>
01044 
01045         <a class="code" href="group__AlgorithmicComponents.html#a9">MergeRepeatedItemsets</a>();
01046         <a class="code" href="Mafia_8good_8cpp.html#a36">F1size</a> = <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>.size();
01047 
01048         <span class="comment">// Create global tail</span>
01049         <a class="code" href="Mafia_8good_8cpp.html#a33">maxtail</a> = <a class="code" href="Mafia_8good_8cpp.html#a36">F1size</a> * (<a class="code" href="Mafia_8good_8cpp.html#a36">F1size</a> + 1) / 2;
01050         gTail = <span class="keyword">new</span> <a class="code" href="classTailElement.html">TailElement</a>[<a class="code" href="Mafia_8good_8cpp.html#a33">maxtail</a>];
01051 
01052         <span class="comment">// Create buffer for sorting</span>
01053         TailBuffy = <span class="keyword">new</span> <a class="code" href="classTailElement.html">TailElement</a>[<a class="code" href="Mafia_8good_8cpp.html#a36">F1size</a>];
01054 
01055         <span class="comment">// Create buffer for estimating size of each subtree</span>
01056         <a class="code" href="Mafia_8good_8cpp.html#a41">EstimateSize</a> = (int)ceil(<a class="code" href="Mafia_8good_8cpp.html#a36">F1size</a> / (<span class="keywordtype">double</span>)<a class="code" href="Mafia_8good_8cpp.html#a42">EstimateDiv</a>);
01057         EstimateBuffy = <span class="keyword">new</span> <a class="code" href="classSubtreeEstimate.html">SubtreeEstimate</a>[<a class="code" href="Mafia_8good_8cpp.html#a41">EstimateSize</a>];
01058         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> estimateIndex = 0; estimateIndex &lt; <a class="code" href="Mafia_8good_8cpp.html#a41">EstimateSize</a>; estimateIndex++) {
01059             EstimateBuffy[estimateIndex].<a class="code" href="classSubtreeEstimate.html#m0">Count</a> = 1;
01060             EstimateBuffy[estimateIndex].<a class="code" href="classSubtreeEstimate.html#m1">Sum</a> = estimateIndex * <a class="code" href="Mafia_8good_8cpp.html#a42">EstimateDiv</a> * estimateIndex * <a class="code" href="Mafia_8good_8cpp.html#a42">EstimateDiv</a> / 2;
01061         }
01062 
01063         <span class="comment">// Initialize global tail</span>
01064         <span class="keywordtype">int</span> uu;
01065         <span class="keywordflow">for</span> (uu = 0; uu &lt; <a class="code" href="Mafia_8good_8cpp.html#a33">maxtail</a>; uu++) {
01066             gTail[uu].<a class="code" href="classTailElement.html#m1">Item</a> = -1;
01067             gTail[uu].<a class="code" href="classTailElement.html#m0">Count</a> = 0;
01068         }
01069 
01070         <span class="comment">// Fill global tail</span>
01071         <span class="keywordflow">for</span> (uu = 0; uu &lt; <a class="code" href="Mafia_8good_8cpp.html#a36">F1size</a>; uu++) {
01072             gTail[uu].<a class="code" href="classTailElement.html#m1">Item</a> = uu;
01073             gTail[uu].<a class="code" href="classTailElement.html#m0">Count</a> = <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[uu]-&gt;Trans-&gt;_count;
01074 
01075             <span class="comment">// assign tail index</span>
01076             <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[uu]-&gt;tBegin = uu + 1;
01077             <span class="keywordflow">if</span> (uu == <a class="code" href="Mafia_8good_8cpp.html#a36">F1size</a> - 1)
01078                 <a class="code" href="Mafia_8good_8cpp.html#a44">F1</a>[uu]-&gt;tBegin = -1;
01079 
01080             TempName = <span class="keyword">new</span> BaseBitmap(<a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a>);
01081 
01082             <span class="comment">// add a buffer element for each item in F1</span>
01083             BaseBitmap *name = <span class="keyword">new</span> BaseBitmap(<a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a>);
01084             <a class="code" href="Mafia_8good_8cpp.html#a46">NameBuffy</a>.push_back(name);
01085             <a class="code" href="classBitmap.html">Bitmap</a> *buff = <span class="keyword">new</span> <a class="code" href="classBitmap.html">Bitmap</a>(<a class="code" href="Mafia_8good_8cpp.html#a14">TransCount</a>);
01086             <a class="code" href="Mafia_8good_8cpp.html#a45">TransBuffy</a>.push_back(buff);
01087             <a class="code" href="classTreeNode.html">TreeNode</a> *newNode = <span class="keyword">new</span> <a class="code" href="classTreeNode.html">TreeNode</a>();
01088             <a class="code" href="Mafia_8good_8cpp.html#a47">NodeBuffy</a>.push_back(newNode);
01089         }
01090 
01091         srand(666);
01092         <span class="keywordtype">bool</span> FHUT;
01093 
01094         <span class="comment">// start algorithm timer</span>
01095         clock_t start, finish;
01096         <span class="keywordtype">double</span> duration = -1;
01097         start = clock();
01098 
01099         time(&amp;<a class="code" href="Mafia_8good_8cpp.html#a67">algorithm_start</a>);
01100 
01101         <span class="comment">// create root node and its associated tail</span>
01102         Root = <span class="keyword">new</span> <a class="code" href="classTreeNode.html">TreeNode</a>(NullName, NullTrans, 0, 0, -1, 0, <a class="code" href="Mafia_8good_8cpp.html#a36">F1size</a>);
01103 
01104         <span class="comment">//Nothing is in MFI, so nothing is relevant</span>
01105         Root-&gt;<a class="code" href="classTreeNode.html#m6">rBegin</a> = 0;
01106         Root-&gt;<a class="code" href="classTreeNode.html#m7">rEnd</a> = 0;
01107 
01108         <span class="comment">// run the appropriate algorithm</span>
01109         <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a7">method</a>.compare(<span class="stringliteral">"-fci"</span>) == 0) {
01110             <span class="comment">//cout &lt;&lt; "running closure (FCI) algorithm..." &lt;&lt; endl;</span>
01111 
01112             <a class="code" href="Mafia_8good_8cpp.html#a19">GoFHUT</a> = <span class="keyword">false</span>;      <span class="comment">// FHUT flag</span>
01113             <a class="code" href="Mafia_8good_8cpp.html#a20">HUTMFI</a> = <span class="keyword">false</span>;      <span class="comment">// HUTMFI flag</span>
01114             <a class="code" href="Mafia_8good_8cpp.html#a21">PEPrune</a> = <span class="keyword">true</span>;      <span class="comment">// PEPrune flag</span>
01115             <a class="code" href="Mafia_8good_8cpp.html#a22">Reorder</a> = <span class="keyword">true</span>;      <span class="comment">// Reorder flag</span>
01116             <a class="code" href="Mafia_8good_8cpp.html#a12">MethodIsFCI</a> = <span class="keyword">true</span>;
01117 
01118             <a class="code" href="Mafia_8good_8cpp.html#a87">MAFIA</a>(Root, <span class="keyword">false</span>, FHUT, <span class="keyword">false</span>);            
01119         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a7">method</a>.compare(<span class="stringliteral">"-mfi"</span>) == 0) {
01120             <span class="comment">//cout &lt;&lt; "running MFI algorithm..." &lt;&lt; endl;</span>
01121             <a class="code" href="Mafia_8good_8cpp.html#a19">GoFHUT</a> = <span class="keyword">true</span>;      <span class="comment">// FHUT flag</span>
01122             <a class="code" href="Mafia_8good_8cpp.html#a20">HUTMFI</a> = <span class="keyword">true</span>;      <span class="comment">// HUTMFI flag</span>
01123             <a class="code" href="Mafia_8good_8cpp.html#a21">PEPrune</a> = <span class="keyword">false</span>;     <span class="comment">// PEPrune flag</span>
01124             <a class="code" href="Mafia_8good_8cpp.html#a22">Reorder</a> = <span class="keyword">true</span>;     <span class="comment">// Reorder flag</span>
01125             
01126             <a class="code" href="Mafia_8good_8cpp.html#a87">MAFIA</a>(Root, <span class="keyword">true</span>, FHUT, <span class="keyword">false</span>);            
01127         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a7">method</a>.compare(<span class="stringliteral">"-fi"</span>) == 0) {
01128             <span class="keywordflow">if</span> (outputMFI) {
01129                 <span class="comment">// open output file</span>
01130                 outFile = <span class="keyword">new</span> <a class="code" href="classItemsetOutput.html">ItemsetOutput</a>(<a class="code" href="Mafia_8good_8cpp.html#a8">outFilename</a>);
01131                 <span class="keywordflow">if</span> (!outFile-&gt;<a class="code" href="group__InputOutput.html#a8">isOpen</a>()) {
01132                     cerr &lt;&lt; <span class="stringliteral">"Output file not open!"</span> &lt;&lt; endl;
01133                     exit(1);
01134                 }
01135             }
01136 
01137             <span class="comment">//cout &lt;&lt; "running FI algorithm..." &lt;&lt; endl;</span>
01138             <a class="code" href="Mafia_8good_8cpp.html#a19">GoFHUT</a> = <span class="keyword">false</span>;      <span class="comment">// FHUT flag</span>
01139             <a class="code" href="Mafia_8good_8cpp.html#a20">HUTMFI</a> = <span class="keyword">false</span>;      <span class="comment">// HUTMFI flag</span>
01140             <a class="code" href="Mafia_8good_8cpp.html#a21">PEPrune</a> = <span class="keyword">false</span>;     <span class="comment">// PEPrune flag</span>
01141             <a class="code" href="Mafia_8good_8cpp.html#a22">Reorder</a> = <span class="keyword">false</span>;     <span class="comment">// Reorder flag</span>
01142             <a class="code" href="Mafia_8good_8cpp.html#a11">MethodIsFI</a> = <span class="keyword">true</span>;
01143 
01144             <a class="code" href="Mafia_8good_8cpp.html#a87">MAFIA</a>(Root, <span class="keyword">false</span>, FHUT, <span class="keyword">false</span>);
01145 
01146             <span class="keywordflow">if</span> (outputMFI) {
01147                 <span class="keyword">delete</span> outFile;
01148             }            
01149         } <span class="keywordflow">else</span> {
01150             cerr &lt;&lt; <span class="stringliteral">"Invalid algorithm option!"</span> &lt;&lt; endl;
01151             exit(0);
01152         }
01153 
01154         finish = clock();
01155         duration = (finish - start) / (double)CLOCKS_PER_SEC;
01156 
01157         printf( <span class="stringliteral">"Algorithm CPU time: %.3f seconds.\n"</span>, duration );
01158 
01159         time(&amp;<a class="code" href="Mafia_8good_8cpp.html#a68">algorithm_finish</a>);
01160         <a class="code" href="Mafia_8good_8cpp.html#a69">algorithm_time</a> = difftime(<a class="code" href="Mafia_8good_8cpp.html#a68">algorithm_finish</a>, <a class="code" href="Mafia_8good_8cpp.html#a67">algorithm_start</a>);
01161         printf(<span class="stringliteral">"Algorithm time: %.2f seconds.\n"</span>, <a class="code" href="Mafia_8good_8cpp.html#a69">algorithm_time</a>);
01162     } <span class="keywordflow">else</span> {
01163         <a class="code" href="Mafia_8good_8cpp.html#a59">MFIBySizes</a>[0]++;
01164     }
01165 
01166 <span class="preprocessor">    #ifdef DEBUG</span>
01167 <span class="preprocessor"></span>    <span class="comment">// output stat data</span>
01168     cout &lt;&lt; <span class="stringliteral">"F1size:      "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a37">FullF1size</a> &lt;&lt; endl;
01169     cout &lt;&lt; <span class="stringliteral">"MFISize:     "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a54">MFI</a>.size() &lt;&lt; endl;
01170     cout &lt;&lt; <span class="stringliteral">"MFIAvg: "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a35">MFIDepth</a> / (double) <a class="code" href="Mafia_8good_8cpp.html#a34">MFISize</a> &lt;&lt; endl;
01171     cout &lt;&lt; <span class="stringliteral">"CountNodes: "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a24">CountNodes</a> &lt;&lt; endl;
01172     cout &lt;&lt; <span class="stringliteral">"CountAnds: "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a26">CountAnds</a> &lt;&lt; endl;
01173     cout &lt;&lt; <span class="stringliteral">"CountSmallAnds: "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a27">CountSmallAnds</a> &lt;&lt; endl;
01174     cout &lt;&lt; <span class="stringliteral">"CountRebuilds: "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a32">CountRebuilds</a> &lt;&lt; endl;
01175     cout &lt;&lt; <span class="stringliteral">"CountCounts: "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a25">CountCounts</a> &lt;&lt; endl &lt;&lt; endl;
01176     cout &lt;&lt; <span class="stringliteral">"CountFHUT:   "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a23">CountFHUT</a> &lt;&lt; endl;
01177     cout &lt;&lt; <span class="stringliteral">"CountHUTMFI: "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a30">CountHUTMFI</a> &lt;&lt; endl;
01178     cout &lt;&lt; <span class="stringliteral">"CountHUTMFISuccess: "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a31">CountHUTMFISuccess</a> &lt;&lt; endl;
01179     cout &lt;&lt; <span class="stringliteral">"CountCheckPosition:   "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a29">CountCheckPosition</a> &lt;&lt; endl;
01180     cout &lt;&lt; <span class="stringliteral">"CountPEPrunes:        "</span> &lt;&lt; <a class="code" href="Mafia_8good_8cpp.html#a28">CountPEPrunes</a> &lt;&lt; endl;
01181 
01182     <span class="comment">/*</span>
01183 <span class="comment">    cout &lt;&lt; "\nBucket count: " &lt;&lt; HT.size() &lt;&lt; endl;</span>
01184 <span class="comment">    int minBucket = 10000000;</span>
01185 <span class="comment">    int maxBucket = -1;</span>
01186 <span class="comment">    long bucketSum = 0;    </span>
01187 <span class="comment">    for (HashTable::iterator hash = HT.begin(); hash != HT.end(); hash++) {</span>
01188 <span class="comment">        cerr &lt;&lt; (*hash).first &lt;&lt; " ";</span>
01189 <span class="comment">        ItemSet *itemset = (*hash).second;</span>
01190 <span class="comment">        int bucketSize = itemset-&gt;size();</span>
01191 <span class="comment">        if (bucketSize &lt; minBucket)</span>
01192 <span class="comment">            minBucket = bucketSize;</span>
01193 <span class="comment">        if (bucketSize &gt; maxBucket)</span>
01194 <span class="comment">            maxBucket = bucketSize;</span>
01195 <span class="comment"></span>
01196 <span class="comment">        bucketSum += bucketSize;</span>
01197 <span class="comment">        cerr &lt;&lt; bucketSize &lt;&lt; endl;            </span>
01198 <span class="comment">    }</span>
01199 <span class="comment"></span>
01200 <span class="comment">    cout &lt;&lt; "Bucket avg: " &lt;&lt; bucketSum / (double) HT.size() &lt;&lt; endl;</span>
01201 <span class="comment">    cout &lt;&lt; "Bucket min: " &lt;&lt; minBucket &lt;&lt; endl;</span>
01202 <span class="comment">    cout &lt;&lt; "Bucket max: " &lt;&lt; maxBucket &lt;&lt; endl;</span>
01203 <span class="comment">    */</span>
01204     
01205 <span class="preprocessor">    #endif</span>
01206 <span class="preprocessor"></span>
01207     <span class="comment">/*for (int sizeIndex = 0; sizeIndex &lt;= maxItemsetSize; sizeIndex++) {</span>
01208 <span class="comment">        cout &lt;&lt; MFIBySizes[sizeIndex] &lt;&lt; endl;</span>
01209 <span class="comment">    }*/</span>
01210 
01211     <span class="keywordflow">if</span> (<a class="code" href="Mafia_8good_8cpp.html#a10">outputMFI</a> &amp;&amp; !<a class="code" href="Mafia_8good_8cpp.html#a11">MethodIsFI</a>) {
01212         <span class="comment">// PrintMFI to a file</span>
01213         <span class="comment">//cout &lt;&lt; "Printing out the mfi..." &lt;&lt; endl;</span>
01214         time(&amp;<a class="code" href="Mafia_8good_8cpp.html#a70">print_start</a>);
01215 
01216         <a class="code" href="group__InputOutput.html#a3">PrintMFI</a>();
01217 
01218         time(&amp;<a class="code" href="Mafia_8good_8cpp.html#a71">print_finish</a>);
01219         <a class="code" href="Mafia_8good_8cpp.html#a72">print_time</a> = difftime(<a class="code" href="Mafia_8good_8cpp.html#a71">print_finish</a>, <a class="code" href="Mafia_8good_8cpp.html#a70">print_start</a>);
01220         printf(<span class="stringliteral">"Printing output time: %.2f seconds.\n"</span>, <a class="code" href="Mafia_8good_8cpp.html#a72">print_time</a>);
01221     }
01222 
01223     time(&amp;<a class="code" href="Mafia_8good_8cpp.html#a62">total_finish</a>);
01224     <a class="code" href="Mafia_8good_8cpp.html#a63">total_time</a> = difftime(<a class="code" href="Mafia_8good_8cpp.html#a62">total_finish</a>, <a class="code" href="Mafia_8good_8cpp.html#a61">total_start</a>);
01225     printf(<span class="stringliteral">"Total time: %.2f seconds.\n\n\n"</span>, <a class="code" href="Mafia_8good_8cpp.html#a63">total_time</a>);
01226 
01227     <span class="keywordflow">return</span> 0;
01228 }<span class="comment"></span>
01229 <span class="comment">/** @} */</span>
01230 
01231 <span class="comment"></span>
01232 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
01233 <span class="comment">/// @mainpage MAFIA Code Documentation</span>
01234 <span class="comment">/// \image html MafiaLogo.jpg</span>
01235 <span class="comment">///</span>
01236 <span class="comment">/// \section ContactSection Contact</span>
01237 <span class="comment">/// - Manuel Calimlim (calimlim@cs.cornell.edu)</span>
01238 <span class="comment">/// - Johannes Gehrke (johannes@cs.cornell.edu)</span>
01239 <span class="comment">///</span>
01240 <span class="comment">/// \section DownloadSection Download</span>
01241 <span class="comment">/// - Main MAFIA webpage</span>
01242 <span class="comment">///   http://himalaya-tools.sourceforge.net/Mafia</span>
01243 <span class="comment">///</span>
01244 <span class="comment">/// \section LinuxCompilationSection Linux Compilation</span>
01245 <span class="comment">/// -# ./configure</span>
01246 <span class="comment">/// -# make</span>
01247 <span class="comment">///     - executable is created as 'src/mafia'</span>
01248 <span class="comment">///</span>
01249 <span class="comment">/// \section WindowsCompilationSection Windows Compilation</span>
01250 <span class="comment">/// -# Use cygwin and follow the Linux instructions</span>
01251 <span class="comment">/// or</span>
01252 <span class="comment">/// -# Use a Windows Compiler or IDE (such as Visual Studio)</span>
01253 <span class="comment">/// to compile the source code.</span>
01254 <span class="comment">///</span>
01255 <span class="comment">/// \section DirectoryStructureSection Directory Structure</span>
01256 <span class="comment">/// &lt;table border=1 cellspacing=5 cellpadding=5&gt;</span>
01257 <span class="comment">/// &lt;tr&gt;</span>
01258 <span class="comment">/// &lt;td&gt;admin/&lt;/td&gt;</span>
01259 <span class="comment">/// &lt;td&gt;Contains config files for compiling.  Should</span>
01260 <span class="comment">///     not be altered.&lt;/td&gt;</span>
01261 <span class="comment">/// &lt;/tr&gt;</span>
01262 <span class="comment">/// &lt;tr&gt;</span>
01263 <span class="comment">/// &lt;td&gt;src/&lt;/td&gt;</span>
01264 <span class="comment">/// &lt;td&gt;Contains all of source code for MAFIA&lt;/td&gt;</span>
01265 <span class="comment">/// &lt;/tr&gt;</span>
01266 <span class="comment">/// &lt;tr&gt;</span>
01267 <span class="comment">/// &lt;td&gt;src/Transaction.h</span>
01268 <span class="comment">/// &lt;br&gt;src/Transaction.cpp&lt;/td&gt;</span>
01269 <span class="comment">/// &lt;td&gt;Class for reading transactions from ASCII datasets&lt;/td&gt;</span>
01270 <span class="comment">/// &lt;/tr&gt;</span>
01271 <span class="comment">/// &lt;tr&gt;</span>
01272 <span class="comment">/// &lt;td&gt;src/ItemsetOutput.h</span>
01273 <span class="comment">/// &lt;br&gt;src/ItemsetOutput.cpp&lt;/td&gt;</span>
01274 <span class="comment">/// &lt;td&gt;Class for writing itemsets to file output&lt;/td&gt;</span>
01275 <span class="comment">/// &lt;/tr&gt;</span>
01276 <span class="comment">/// &lt;tr&gt;</span>
01277 <span class="comment">/// &lt;td&gt;src/BaseBitmap.h</span>
01278 <span class="comment">/// &lt;br&gt;src/BaseBitmap.cpp&lt;/td&gt;</span>
01279 <span class="comment">/// &lt;td&gt;Simple bitmap class for name bitmaps&lt;/td&gt;</span>
01280 <span class="comment">/// &lt;/tr&gt;</span>
01281 <span class="comment">/// &lt;tr&gt;</span>
01282 <span class="comment">/// &lt;td&gt;src/Bitmap.h</span>
01283 <span class="comment">/// &lt;br&gt;src/Bitmap.cpp&lt;/td&gt;</span>
01284 <span class="comment">/// &lt;td&gt;Main bitmap class for transaction bitmaps&lt;/td&gt;</span>
01285 <span class="comment">/// &lt;/tr&gt;</span>
01286 <span class="comment">/// &lt;tr&gt;</span>
01287 <span class="comment">/// &lt;td&gt;src/Mafia.cpp&lt;/td&gt;</span>
01288 <span class="comment">/// &lt;td&gt;Main class file with most of the MAFIA code&lt;/td&gt;</span>
01289 <span class="comment">/// &lt;/tr&gt;</span>
01290 <span class="comment">/// &lt;tr&gt;</span>
01291 <span class="comment">/// &lt;td&gt;src/Tables.h&lt;/td&gt;</span>
01292 <span class="comment">/// &lt;td&gt;Stores precomputed lookup tables (not included in</span>
01293 <span class="comment">///    documentation due to very large tables)&lt;/td&gt;</span>
01294 <span class="comment">/// &lt;/tr&gt;</span>
01295 <span class="comment">/// &lt;tr&gt;</span>
01296 <span class="comment">/// &lt;td&gt;src/TreeNode.h&lt;/td&gt;</span>
01297 <span class="comment">/// &lt;td&gt;Class for representing nodes in the search tree&lt;/td&gt;</span>
01298 <span class="comment">/// &lt;/tr&gt;</span>
01299 <span class="comment">/// &lt;tr&gt;</span>
01300 <span class="comment">/// &lt;td&gt;INSTALL&lt;/td&gt;</span>
01301 <span class="comment">/// &lt;td&gt;Generic installation instructions for Linux/Unix&lt;/td&gt;</span>
01302 <span class="comment">/// &lt;/tr&gt;</span>
01303 <span class="comment">/// &lt;tr&gt;</span>
01304 <span class="comment">/// &lt;td&gt;mafia.{kdevprj,kdevses}&lt;/td&gt;</span>
01305 <span class="comment">/// &lt;td&gt;KDevelop project files for Linux&lt;/td&gt;</span>
01306 <span class="comment">/// &lt;/tr&gt;</span>
01307 <span class="comment">/// &lt;tr&gt;</span>
01308 <span class="comment">/// &lt;td&gt;README&lt;/td&gt;</span>
01309 <span class="comment">/// &lt;td&gt;Pointer this page&lt;/td&gt;</span>
01310 <span class="comment">/// &lt;/tr&gt;</span>
01311 <span class="comment">/// &lt;/table&gt;</span>
01312 <span class="comment">///</span>
01313 <span class="comment">/// \section UsageSection Program Usage</span>
01314 <span class="comment">/// &lt;pre&gt;</span>
01315 <span class="comment">/// Usage: mafia [-mfi/-fci/-fi] [min sup (percent)]</span>
01316 <span class="comment">///         [-ascii/-binary] [input filename]</span>
01317 <span class="comment">///         [output filename (optional)]</span>
01318 <span class="comment">/// Ex: mafia -mfi .5 -ascii connect4.ascii mfi.txt</span>
01319 <span class="comment">/// Ex: mafia -mfi .3 -binary chess.binary</span>
01320 <span class="comment">/// &lt;/pre&gt;</span>
01321 <span class="comment">///</span>
01322 <span class="comment">/// \section InputSection File Input</span>
01323 <span class="comment">/// Datasets can be in ASCII or binary format.</span>
01324 <span class="comment">/// For ASCII files, the file format must be:</span>
01325 <span class="comment">/// &lt;pre&gt;</span>
01326 <span class="comment">/// [item_id_1] [item_id_2] ... [item_id_n]</span>
01327 <span class="comment">/// &lt;/pre&gt;</span>
01328 <span class="comment">///</span>
01329 <span class="comment">/// Items do not have to be sorted within each transaction.</span>
01330 <span class="comment">/// Items are separated by spaces and each transaction</span>
01331 <span class="comment">/// should end with a newline, e.g.</span>
01332 <span class="comment">/// &lt;pre&gt;</span>
01333 <span class="comment">/// 1 4 2</span>
01334 <span class="comment">/// 2 8 9 4</span>
01335 <span class="comment">/// 2 5</span>
01336 <span class="comment">/// &lt;/pre&gt;</span>
01337 <span class="comment">///</span>
01338 <span class="comment">/// For binary files, the file format must be:</span>
01339 <span class="comment">/// &lt;pre&gt;</span>
01340 <span class="comment">/// [custid][transid][number of items][itemid_1][itemid_2] ... [itemid_n]</span>
01341 <span class="comment">/// &lt;/pre&gt;</span>
01342 <span class="comment">///</span>
01343 <span class="comment">/// The custid and transid numbers are ignored at this time.</span>
01344 <span class="comment">/// Since the file is in binary format, all numbers are read</span>
01345 <span class="comment">/// as integers.</span>
01346 <span class="comment">///</span>
01347 <span class="comment">/// \section DatasetsSection Datasets</span>
01348 <span class="comment">/// Download &lt;a href="http://sourceforge.net/project/showfiles.php?group_id=72667"&gt;Datasets-ascii.tar.gz&lt;/a&gt;</span>
01349 <span class="comment">/// or &lt;a href="http://sourceforge.net/project/showfiles.php?group_id=72667"&gt;Datasets-binary.tar.gz&lt;/a&gt;</span>
01350 <span class="comment">/// for the full set of datasets used for testing:</span>
01351 <span class="comment">/// - chess.{ascii,binary}</span>
01352 <span class="comment">/// - connect4.{ascii,binary}</span>
01353 <span class="comment">/// - mushroom.{ascii,binary}</span>
01354 <span class="comment">/// - pumsb.{ascii,binary}</span>
01355 <span class="comment">/// - pumsb_star.{ascii,binary}</span>
01356 <span class="comment">///</span>
01357 <span class="comment">/// \section OutputSection Program Output</span>
01358 <span class="comment">/// The frequent itemsets outputted by the program are</span>
01359 <span class="comment">/// in ASCII form with the following format:</span>
01360 <span class="comment">/// &lt;pre&gt;</span>
01361 <span class="comment">/// [item_id_1] [item_id_2] ... [item_id_n] [(support)]</span>
01362 <span class="comment">/// &lt;/pre&gt;</span>
01363 <span class="comment">/// Ex:</span>
01364 <span class="comment">/// &lt;pre&gt;</span>
01365 <span class="comment">/// 28 64 42 60 40 29 52 58 (966)</span>
01366 <span class="comment">/// 46 64 42 3 25 9 5 48 66 56 34 62 7 36 60 40 29 52 58 (962)</span>
01367 <span class="comment">/// 39 36 40 29 52 58 (960)</span>
01368 <span class="comment">/// &lt;/pre&gt;</span>
01369 <span class="comment">/////////////////////////////////////////////////////////////////////</span>
01370 <span class="comment"></span>
</pre></div><hr><address style="align: right;"><small>Generated on Thu Dec 4 13:38:32 2003 for MAFIA by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
